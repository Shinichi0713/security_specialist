# 2023 spring pm1

## 問題1

SI企業。オフィス半版を行うY社よりシステム開発を受託

開発プロジェクトのリーダにはD主任。セキュリティの品質を担保。プログラミング完了後に性的解析。

システムテストを開始→注文情報照会で不具合。利用者IDでログインしても注文番号を入力。セッションオブジェクトに保存。

注文情報照会機能ではクラスが保存。システムテストを開始→不具合はログイン注文番号。得意先コード＋セッションオブジェクトに保存。注文情報→業務処理を実行するクラス＋リクエスト処理を実行するクラス。

オフィス用品を注文する機能。注文情報を照会する機能。

8-11の書き換え

システムテストを開始→注文情報照会→利用者IDでログイン→注文番号

利用者IDと得意先コードはセッションオブジェクトに保存されている。別の得意先の注文情報が出力される。

## 問題2

精密機器の部品の中堅製造業。ネットワーク構成。

サーバ、FW、L2SWなどはログ管理鯖。DMZのサーバのログは常時監視。ログイン失敗が発生した場合にアラートがメール。

FWはステートフルパケットインスペクション。通信の許可、拒否についてのログを記録する。FWはInet→サーバへの通信は許可。443/TCPだけを許可。

Internetへの通信は許可。NATによる変換。アラートは受付SVとDBSV。SSHログイン失敗。

不正アクセスにより受付サーバが侵害→DMZと向上LAN。

ネットワーク接続→psコマンド結果。srv。ハッシュは攻撃。バインドモード。C&Cサーバに接続→コマンドライン引数。ポートスキャン。IDで辞書攻撃する。

攻撃者はCCSVとの接続に成功→スキャン開始。ポート巣化yンによりPID。

# 2023 spring pm2

## 問題1

A社グループ製造業。グループ会社がある。IT資産管理を効率化。

立ち上げ、CISOの推進部。セキュリティ推進の業務は3つ。

脆弱性診断。会員サイトでリリース。Bで診断。

セキュアコーディング規約。診断実施。市場拡大により開発の増加。セキュリティ診断。二世か推進プロジェクト起動。セキュリティコンサルの支援。診断項目の決定。

士とMでアンケー。フェーズ3の評価を基に診断手順を作成。サイトNで診断実施。

サイトの診断にツールVを導入する。

DASTのツール。ぱらめーを初期値からHTTPリクエスト。

プロジェクトの作成機能：FQDNを登録してプロジェクトを作成。

診断URLの自動登録機能：探索を開始するURLを指定→自動探索してたどる。

手動登録も可能。URLにひもづくパラメータは自動的に登録される。

リクエストを複数回送信すると拒否される診断対象URLには本機能を登録。

項数はほぼ不要。品質で登録→URLがJSなどで動的に生成されるような場合。

作業者の工数が必要。手動でたどったとして、URLを診断対象とする→別方法で調べる。

Zさんの診断と比較。脆弱性の一部を検出できていない。

XSSはSQLインジェクション。サイトMの入力1より画面遷移。

アンケーと1→通信完了。トピック検索画面で処理と診断でぱらめーtの件数。XSSはエスケープ処理。ツールVの設定。keywordが文字列として扱われる。

フェーズ3での診断結果の分析。脆弱性かぎ要請かの判断は開発。診断の結果の報告内容、リスクは直接問い合わせる。

サイトNの診断。キャンペーンの登録、製品情報閲覧。メアドは新規の申し込みできない。

グループの概念がある。URLがJSで動的製紙絵。IDはcookierに保持。IDは破棄。

開発NよりHttpOnlyがついている。手動で診断し、回避の脆弱性を検出。

アクセス制御を回避するように細工→リクエストを送出。

フェーズ5の診断の課題の対策を検討。診断手順を完成→展開

# 秋午後問題

## 問題1

Q社EC事業。WEBアプリQにアクセス。商品レビュー

ログイン→セッションID。商品レビュー。会員プロフィール。ログイン会員のみ利用可能。uploadに焚いて。

トークンがアクセスして払い出されたものと一致→アップロードが成功。

１６件レビューではない。→XSSの脆弱性がある

WEBアプリQ。ECサイトを運営。アプリQにHTTPSでアクセス。

ECサイトの会員登録。ログイン→cookieを払い出し。商品レビュー

会員プロフィール→クレジットカードページVでレビュー。

２件しかヒィウジ。会員のレビューが少ない。

## 問題2

L社あアパレルの会社。都内オ大通り

USBメモリに保存し、持ち込む。

セキュリティ対策の見直し。NPCの情報漏洩対策ソフトを導入。

ファイル保存を禁止。クラウドストレージへの通信を遮断。

Bサービスのまとめ。社内FSV廃止。従業員LAN、来客LANVLAN機能あり。

FW：ステートフル。NAT。リレー

AP：無線LANはWPA。SSIDの両方が設定。MACフィルタリング。

Bサービス：HSTS。ID＋PW。

Bサービスのファイル共有

VLANインターフェース。

FWのNAT。DHCPリレー。AP-5の設定。SSID通知。暗号化方法。

エきゅりてぃレビュー。

M社の業務PCを偽APに接続。偽APに接続。Bサービスから持ち出す。

## 問題3

N社Nsa-bisu。インテグレーション。VCSにコミット。

リポジトリで管理。sauceコード取得。SSH鍵により。

コマンド実行機能→サウスを取得の後、shでシェル。環境変数をシークレットと呼ぶ。

foronntoエンド→APIをもつサイト。DBサービス；VCSのホスト名。バックエンド：linux。コマンド実行機能。

仮想ネットワーク；バックエンドを互いに接続する。

CIデーモンは新しいコンテナを起動し、取得機能→コマンド実行機能を順に実行。スクリプトは任意のコマンドを記j津出来る。コンテナんの脆弱性を悪用しなくても成功してもナウ。

クラウド基盤を管理するサイトも提供→ログ監視している。スマホ用アプリに表示される。

CIデーモンはコンテナ起動→コマンド実行。

TOTPをログインに入力

国外IPよりアクセス→攻撃。

一般権限のコンテナは他コンテナに対するプロセス取得や、リソース操作はできない

Nアs－ビスでPアプリ。利用者に配布する。

認証APIキーをヘッダに付与。コードサイニング認証。スマホ


## 問題4

G百貨店。菓子類。

値域運送貨車。W社。SサービスでSaaS。Z情報。

６時間交代では総業務。Sサービスカウントを貸与。ランサムウェアによる２重の脅迫。リスクアセスメントの実施。

E社の調査に応じるW社のネットウェアーく校正。同一アカウントにょるログインが可能。IPアdレスのリストを設定できる。I'アドpレスのリストはアカウントごとに設定可能。

アカウントごとに機能利用の許可・禁止を選択可能

脆弱性プログラムは地帯なく。本社事務室への入室制限。標的型こうげきの周知。不正行為の動機付け。

リスク元の特定。事象の分類。機密情報への経緯。リスク低減の管理策の検討。

表のア→エ

W社外の第３者による攻撃。Sサービスの偽サイトを作った→誘導

外部PCからWPCを操作する。

配送員を装う→聞き出す。

IDとPWを聞き出すか、Z情報を取得するそれ以外の方法。

了解しました。まず参照している問題冊子を確認しました。

問4-設問2「リスク源として考えられること」を想定して、試験で取り上げやすい（かつ実務的に重要な）**リスク源の項目をカテゴリ別に網羅的に列挙**します。各項目は短い説明付きにしておきます — 試験の回答では「列挙＋代表例・影響」を簡潔に書くと良いです。

---

### 1) 人（人的リスク）

* 内部不正（従業員・元従業員による不正アクセス、情報持ち出し）
* ヒューマンエラー（設定ミス、操作ミス、誤送信、誤消去）
* ソーシャルエンジニアリング（フィッシング、なりすまし電話）
* 管理不足（権限の過剰付与、退職者アカウント放置）

### 2) 技術（システム／ソフトウェア）

* ソフトウェア脆弱性（既知/未知の脆弱性、未適用のパッチ）
* 設定ミス・構成不備（ファイアウォール・ACL・CORS設定ミス）
* 認証・セッション管理の欠陥（弱いパスワード、セッション固定）
* サードパーティ／ライブラリのリスク（サプライチェーン攻撃）

### 3) ネットワーク／通信

* パケット盗聴・中間者攻撃（通信の暗号化不備）
* DDoS（サービス妨害攻撃）や帯域枯渇
* ネットワーク分離不足（内部ネットワークと公開サービスの分離不備）

### 4) 物理的／環境的リスク

* 電源障害（停電、UPS不備）
* ハードウェア故障（ディスク故障、サーバ障害）
* 災害（火災、洪水、地震などによる施設被害）
* 物理的侵入・盗難（サーバ盗難、設備破壊）

### 5) 運用・プロセス

* バックアップ不備（未実行・検証不足）
* 変更管理の欠如（テスト不足で本番障害）
* 監査・ログ管理の不備（不正検知遅延）
* インシデント対応体制の不備（手順や連絡網が無い）

### 6) サプライチェーン・外部依存

* クラウド事業者／ISP障害や停止
* 外部委託先（ベンダー）のセキュリティ不備
* 依存サービスのAPI変更や提供停止

### 7) 法務・コンプライアンス

* 個人情報保護法や規制違反による罰則・行政処分
* 契約・ライセンス違反（サードパーティ利用の法的リスク）

### 8) データ関連リスク

* 機密情報の漏えい（データ流出）
* データ改ざん（整合性破壊）
* データ消失・破損（バックアップ障害含む）

### 9) 外部の悪意ある攻撃者

* 標的型攻撃（APT）や継続的侵害
* マルウェア・ランサムウェア感染
* CSRF / XSS / SQLインジェクション 等のウェブ攻撃

### 10) 組織的リスク・人的資源

* 人材不足（スキル不足で運用ミス）
* 組織変更や経営判断によるサポート切れ

---

## 回答例（試験向け・短くまとめる場合）

> リスク源として、（1）人的要因（内部不正・操作ミス・ソーシャルエンジニアリング）、（2）技術的要因（ソフトウェア脆弱性・設定ミス・認証不備）、（3）外部依存（クラウド・ベンダ障害、サプライチェーン攻撃）、（4）物理・環境（停電・災害・盗難）、（5）運用・プロセス（バックアップ不足・変更管理欠如）、（6）法令・コンプライアンス（規制違反）などが考えられる。各リスクは情報漏洩、サービス停止、データ消失、法的制裁などの影響を与える。

---

必要なら、**問4 の設問文に沿って（対象システムが何かに合わせて）この一覧を絞り込み・優先順位付け**して、想定される影響度・発生確率・対策案まで含めた解答例を作成します。どの程度の詳細が欲しいですか？ (例えば「上位5個を選んで影響度と対策を書く」など)

## ジャンル

中間者攻撃

標的型攻撃

webページを閲覧→情報閲覧する→外部送出する
===========================================

いい質問です — CSRF（Cross-Site Request Forgery、クロスサイトリクエストフォージェリ）はウェブの代表的な **“なりすまし型” 攻撃** の一つで、被害者のブラウザが持つ認証情報（例：ログイン済みのセッション cookie）を悪用して、そのユーザになりすましてサイト上の操作を勝手に実行させるものです。まずは**高レベルな仕組み**と**攻撃パターンの概観（具体的手順や実装コードは提供しません）**、そして**防御／検出方法**を説明します。

---

# 1) CSRF の基本アイデア（概念）

* ユーザAがサイト S にログインしている状態で、攻撃者サイト M を訪れる。
* 攻撃者サイト M がユーザのブラウザを介して、**ユーザの認証情報付きで** サイト S にリクエストを送らせる（ブラウザは自動的に cookie を送る）。
* サーバ側がそのリクエストが正当なユーザからのものか区別できないと、意図しない操作（設定変更、送金、投稿など）が実行されてしまう。

---

# 2) よく使われる攻撃パターン（高レベル説明）

> 実際の攻撃コードや具体的なエクスプロイトの書き方は説明しませんが、攻撃者が利用する「手法の種類」は以下の通りです。

* **自動送信されるフォーム**
  攻撃者ページにユーザが訪れると、hidden な `<form>` を自動 submit してターゲットサイトの状態変更 API を叩かせる（ブラウザは cookie を付与する）。
* **画像タグやリンクを利用した GET リクエスト**
  `<img src="https://target.example/transfer?amount=100&to=attacker">` のように、画像ロードで GET パラメータを通じてリクエストを送る（注：安全な設計では副作用のある操作に GET を使わない）。
* **スクリプトによる XHR/Fetch（制限あり）**
  同一生成元ポリシー(CORS)により制約はあるが、古い設定や脆弱な CORS 設定があると使われる場合がある。
* **ログイン CSRF**
  攻撃者が別アカウントでターゲットをログインさせ、ユーザの操作履歴や認可状態をずらす攻撃。
* **リンク誘導（ソーシャルエンジニアリング）**
  メールやメッセージに悪意あるリンクを貼ってアクセスさせ、意図せぬ操作を行わせる。

> 要点：攻撃は「ユーザのブラウザが自動で（あるいは誘導されて）リクエストを送る」ことを利用する。ブラウザは通常、同サイトの cookie を自動で付けるため、それが悪用される。

---

# 3) なぜ CSRF が成立するのか（技術的背景）

* ブラウザはドメインに紐づく cookie を自動で送信する（`Set-Cookie` → `Cookie`）。
* 多くのウェブアプリは cookie の有無だけでリクエストの正当性を判断していると、第三者サイト経由でも同じ cookie が送られてしまう。
* そのため「送信元が本当に自サイトの UI からの操作か」をサーバ側で判別できないと危険。

---

# 4) 防御（推奨対策） — 実装レベルでできること（安全指針）

以下は **実装可能で効果の高い防御策** です。具体コードではなく要点を示します。

1. **CSRF トークン（ワンタイムトークン）**

   * サーバでユーザセッションに紐づくランダムで予測不能なトークンを発行し、フォームや状態変更リクエストにそのトークンを同送させる。
   * サーバはリクエスト中のトークンとセッションのトークンを照合して正当性を確認する。
   * トークンは `POST` の body やカスタムヘッダ（XHR）で渡す。
   * フレームワークには CSRF ミドルウェアがあることが多い（Django, Rails, Spring, Express のライブラリ等）。
2. **SameSite 属性を持つ Cookie**

   * Cookie に `SameSite=Lax` あるいは `SameSite=Strict` を設定することで、第三者サイトからのクロスサイト送信で cookie が送られないようにできる。
   * `Lax` は一般的な保守性と効果のバランス良好。ログイン状態の他の影響も確認すべし。
   * 常に `Secure`（HTTPS必須）と可能なら `HttpOnly` を付ける。
3. **Referer / Origin ヘッダ検証**

   * 状態変更（POST/PUT/DELETE 等）のリクエストで `Origin` または `Referer` を検査し、期待するドメインからのリクエストのみ受け付ける。
   * `Origin` ヘッダは比較的信頼性が高い（クロスオリジンな場合に常に送られる）。ただし古いブラウザや一部条件で無い場合があるのでトークンと併用。
4. **副作用のある操作を GET にしない**

   * GET は安全で副作用が無い設計にする（REST の原則）。副作用は POST/PUT/DELETE に限定。
5. **ダブルサブミット Cookie パターン（トークンの二重送信）**

   * Cookie に値を入れ、リクエスト body / header に同じ値を入れて照合する。トークンをサーバで検証できれば有効。
6. **認証の強化 / 追加確認**

   * 金額変更や重要設定などは2段階認証、パスワード再入力、CAPTCHA を要求する。
7. **CORS の安全な設定**

   * 必要最小限のオリジンのみを許可し、`Access-Control-Allow-Credentials` を不用意に有効にしない。
8. **X-Frame-Options / Content-Security-Policy**

   * クリックジャッキングなどの別攻撃と組み合わせられることを防ぐために `X-Frame-Options: DENY` や CSP の `frame-ancestors` を使う。
9. **脆弱性の一括対策はフレームワークの機能を使う**

   * ほとんどのモダンフレームワークが CSRF 対策を提供しているので、推奨のミドルウェアを正しく設定する。

---

# 5) 検出・ログとモニタリングのヒント

* 予期せぬ状態変更（同一ユーザからの短時間連続操作、異常な IP からの複数アクション）を監視。
* `Referer` や `Origin` が空または外部ドメインの POST をログに残して分析。
* 重要操作に対してはサーバ側で確認（トークン失敗回数、同一トークンの再利用など）をログ化してアラート化。

---

# 6) CSRF と XSS の違い（重要）

* **CSRF**：ユーザのブラウザが勝手に（または誘導で）正当な cookie を使ってリクエストを送ることで成立。防御は主にトークンや SameSite。
* **XSS（クロスサイトスクリプティング）**：攻撃者が任意のスクリプトを被害サイト上で動作させることで、cookie/トークンを盗んだり任意操作を行える。
* **重要**：XSS が成立すると CSRF 対策（トークン含む）を回避される可能性があるため、XSS 対策（入力検証、出力エスケープ、CSP）も同時に必須。

---

# 7) テストについて（安全に）

* 自分の環境・自分のアプリに対してのみ **防御効果を検証する目的で** テストを行うのは許容されます。
* 他人のサイト・システムを攻撃・検査するのは違法かつ倫理違反です。必ず許可を得た環境で行ってください。
* テストツールはフレームワークの CSRF ミドルウェアが正しく動作するかを確認する程度に留めるべきです。

---

# 8) まとめ（推奨行動）

1. フレームワーク組み込みの **CSRF ミドルウェアを有効化**。
2. `SameSite` + `Secure` + `HttpOnly` を cookie に設定。
3. `Origin` / `Referer` をチェック、重要操作には追加検証を要求。
4. XSS 対策とセットで実装（入力検証・出力エスケープ・CSP）。
5. ログ監視で不審なリクエストを検出。

---

もっと具体的に手を動かして対策コードや設定例（Django / Flask / Express / Rails / Spring 等）を提示できます。
どの言語/フレームワークで実装しているか教えてもらえれば、**安全な実装例（サーバ側の設定・ミドルウェア利用法・Cookie 設定例・ヘッダの検査方法）** を示します。どれが良いですか？
