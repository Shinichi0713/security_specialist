## FW

ファイアウォールの分類方法

| 種類                                 | 違い                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| パケットフィルタリング               | ルータ同様IPパケットを通過させるか、しないかを判断する                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| サーキットレベルゲートウェイ型       | [TCP](https://e-words.jp/w/TCP.html)や[UDP](https://e-words.jp/w/UDP.html)などの[トランスポート層](https://e-words.jp/w/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E5%B1%A4.html)のレベルで内外の[通信](https://e-words.jp/w/%E9%80%9A%E4%BF%A1.html)を中継するもの。<br />サーキットレベルゲートウェイは[TCP](https://e-words.jp/w/TCP.html)（[Transmission Control Protocol](https://e-words.jp/w/TCP.html)）や[UDP](https://e-words.jp/w/UDP.html)（[User Datagram Protocol](https://e-words.jp/w/UDP.html)）による内外の[通信](https://e-words.jp/w/%E9%80%9A%E4%BF%A1.html)を中継するが、通過する[パケット](https://e-words.jp/w/%E3%83%91%E3%82%B1%E3%83%83%E3%83%88.html)の送信元や宛先を[動的](https://e-words.jp/w/%E5%8B%95%E7%9A%84.html)に書き換え、外部の[ホスト](https://e-words.jp/w/%E3%83%9B%E3%82%B9%E3%83%88.html)に対して自分が通信主体であるかのように見せかける。 |
| アプリケーションレベルゲートウェイ型 | アプリケーションゲートウェイ型ではアプリケーションレベルの制御が可能                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| パーソナルファイアウォール           | PCにインストールしてクライアント端末のみを守る                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| WAF                                  | WAFとは「Web Application Firewall（ウェブアプリケーションファイアウォール）」の略<br />Webアプリケーションへの不正なWeb攻撃を防ぐために開発された専用防御ツール<br />WAFがWebアプリケーション層でのセキュリティ対策であるのに対し、**ファイアウォールはネットワークレベルでのセキュリティ対策**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| L7ファイアウォール                   | アプリケーションレベルの動作を含む制御が可能<br />コンテンツフィルタリング機能<br />L7ファイアウォールは、マルウェア、フィッシング、DDoS攻撃などの高度な脅威を検出し、対策を講じることができます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

#### ゲートウェイ

ゲートウェイとは、異なるネットワーク間の通信を仲介するデバイスやソフトウェアのこと。

ネットワークやインターネットを接続するルータもゲートウェイの一種。

#### サーキットレベルGW

通信の内容は確認せず、接続のセッション情報をもとに通信の許可、拒否を制御する。

内部ネットワークと外部ネットワークの間でプロキシとして機能し、直接の通信を防ぐ。

#### ステートフルインスペクション

ファイアウォールを通過したパケットを管理して、正常な通信とみなせるもの(対応する戻りパケットか、パケットの順番、コネクションの状況など)だけを通過させる機能を持つファイアウォールのこと

#### L7ファイアウォールとアプリケーションレベルゲートウェイ型違い

* **動作の仕組み** ：
* **L7ファイアウォール** ：アプリケーション層でのトラフィックを詳細に検査し、特定のアプリケーションプロトコル（例：HTTP、HTTPS、FTPなど）に基づいてトラフィックをフィルタリングします。これにより、アプリケーションレベルでの不正なアクセスや攻撃を防ぎます。
* **アプリケーションレベルゲートウェイ** ：プロキシサーバーとして機能し、クライアントとサーバーの間に立って通信を仲介します。これにより、クライアントのIPアドレスを隠し、セキュリティを強化します。
* **検査の深さ** ：
* **L7ファイアウォール** ：トラフィックの内容を詳細に検査し、特定のアプリケーションプロトコルに基づいてトラフィックを許可または拒否します。コンテンツフィルタリングやユーザー認証などの高度な機能を提供します。
* **アプリケーションレベルゲートウェイ** ：トラフィックの内容を検査することは少なく、主に接続の確立と終了を監視し、セッション情報に基づいて通信を制御します。
* **用途** ：
* **L7ファイアウォール** ：高度な脅威検出やコンテンツフィルタリングが必要な環境で使用されます。例えば、企業のネットワークでのセキュリティ強化や、特定のアプリケーションの保護に適しています。
* **アプリケーションレベルゲートウェイ** ：プロキシサーバーとしての機能が求められる環境で使用されます。例えば、内部ネットワークのIPアドレスを隠すためや、特定のアプリケーションへのアクセスを制御するために使用されます。

#### ACL

ステートフルインスペクション型ファイアウォールのACL(セッション情報のみのFW)のフィルタリングルール

ルールの原則は以下の通り

1. 通常の通信は"ALL"or"ANY"で禁止
2. 許可する通信のみを許可

懸念として、社内のDMZのサーバに攻撃されて、踏み台にされた場合を想定。この場合でも、必要最小限の通信のみを許可する設定であれば、被害規模を抑えることが出来るようになる

#### 危険なポートをふさぐ

windowsで利用される135、137～139、445は利用がないならば原則禁止とすべき。

これまでwindowsのセキュリティホールをつくウィルスが多く発見されているため。

#### ファイアウィールの運用

- ファイアウォールを構築後は、実際の想定通りか確認のテストをする。特に仮想の攻撃を想定して、外部から行うようなテストをぺなとレーションテストと呼ぶ
- 運用のデータは基本的にログをとる

ログの確認の理由

1. ハッキングの初動を掴む
2. 長期的なハッキングを検出する
3. 日々と異なる動作を検出する

SIEMのようなログ可視化ツールを用いて、異常を早期に検出することを目指す

## IDSとIPS

ファイアウォールのみでは防ぐことが出来ない侵入への対抗措置としてIDSやIPSが用いられるケースがある。

#### IDS

IDSは侵入を検出するシステム。

ホスト型とネットワーク型の２種類に分類される。

動作は検知後にFWと連携してパケットをふさいだり、メールで通知したりという挙動を設定することが出来る。

| type                     | 特徴                                                                                                                                                                                                                         |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| HIDS<br />ホスト型       | 監視対象となるホストにインストールして、ホスト自体を監視する<br />①対象ホストのログファイルを監視<br />②ホストが受信する送受信パケットを監視<br />③ファイルの不正な改ざんを監視                                           |
| NIDS<br />ネットワーク型 | 監視対象のネットワークセグメントに設置し、ネットワーク内を流れるパケットを監視する<br />①プロミスキャス：自分宛でないパケットもすべて監視する<br />②ステルス：IPアドレスを振らない<br />③SW-HUB：モニタリングポートに接続 |

#### IPS

不正な侵入を監視・検知することが目的のIDSに対して、侵入される前に食い止めることが目的にしたシステムがIPS。

不正な通信と判断した通信を、自動的に遮断する機能を持ち、侵入そのものを阻止する。

インライン接続ですべての通信が通過するラインに設置すれば、最初の侵入を阻止することが可能となる。(IDSでは不可能なこと)

#### 検知の仕組み

不正アクセスを検知する仕組みには大別すると２種類

1. Misuse検知：不正アクセスを事前に定義しておく
2. Anomaly検知: 正常パターンを事前に定義しておく

##### Misuse検知

不正アクセスの攻撃パターンをDB化しておき、登録された不正アクセスパターンとの比較により、正常アクセスかどうかを判断する仕組み。

パターンマッチングと呼ばれる。

既知の不正アクセスには強いが、未知の不正アクセスには弱い

##### Anomaly検知

正常となるパターンを登録しておき、正常動作から外れた動作を行うものを異常として検知する方法。

シグネチャを用いた検知の仕組みと異なり、未知の異常にも対応できるのが長所。

## UTM

ファイアウォールにIDSやIPSが融合したデバイス

ファイアウォールを軸にして、VPN機能、IPS、アンチウイルス、コンテンツフィルタなどの機能を持たせることもあり、UTM自体に明確な定義はない

因みに、UTM製品を導入すると、コストや管理の手間が省けるというメリットがあるが、すべての通信のチェックを行うことはかなり負荷が大きい。→導入時は負荷とメリットを十分に考慮すると良い。
