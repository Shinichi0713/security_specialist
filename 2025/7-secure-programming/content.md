## 言語

#### Java

オブジェクト指向そのもののもつカプセル化の概念により情報が隠蔽される。

Java2からはAccessController or SecurityManagerを用いて任意のセキュリティポリシを適用できる"ポリシベース"のセキュリティ管理が可能となった。

Javaにはサンドボックスモデルというセキュリティモデルがあった。限られた保護領域下のみで実行させることで、安全にJavaプログラムを動作させるモデル。

サンドボックスモデルやポリシーベースを利用すれば、ローカルJava、リモート署名付きモバイルコードのおかげできめ細かい制御が可能となる。

##### メモリ管理

JavaVM：メモリ管理はプログラマが意識しなくてもJavaVMが行う→バッファオーバーフローは生じない。ガーベージコレクションなる機能がある。

#### C言語/C++

セキュリティの概念がなかったころからの言語。

考慮しなくてはならないこと

- バッファオーバーフロー：データ領域からのあふれ
- ポインタによる誤った領域へのアクセス
- データポインタと関数へのポインタへの混同
- 整数演算での桁あふれ
- メモリリーク：動的メモリブロックが解法されない

ヒープ領域：動的な確保可能なメモリ領域

malloc関数：動的メモリ確保の関数

free関数：動的メモリ解放の関数

new演算子：メモリ確保の関数

delete演算子：メモリ解放の演算子

#### ECMAScript

Ecma Internationalにより、Scriptの標準化を狙って策定されたのがECMAScript。多くの企業のJavaScriptがECMAScriptに準拠。

JavaScriptとJScriptから共通部分を取り出すことで標準化。

- Webサーバー自体のセキュリティ対策
- 入力チェックをサーバー側でも実施する
- サニタイジング処理組み込みの徹底
- バリデーションチェック組み込みの徹底

#### JNI

Javaには他言語で書かれたネイティブコードを連携するJNIという仕様がある。JNIを利用することで、他の言語で書かれたネイティブコードを実行したり、他言語で書かれたネイティブコードからJavaで書かれたプログラムを実行することが出来る。

他の言語で書かれた部分については別途メモリ管理する必要がある。JavaVMはメモリ管理を行わないため。

## クロスサイトスクリプティング

一般利用者がインターネットを利用している一般ユーザーが悪意あるサイトを閲覧した際に受ける攻撃の一種。

#### 反射型XSS

代表的なXSS。非持続性という分類がされる。

WEBアプリで入力項目となる文字列をエスケープ処理していないサイト

__事前段階__

自ら立ち上げたwebサイトやメール本文に脆弱性のあるサイトのリンクに、実行させたい"スクリプト"を含めておいてリンクが踏まれるのを待つ。

__被害者がクリック__

ある利用者がリンクをクリックするとリンクに続いてる記述をスクリプトと認識して、スクリプトを含むレスポンスを利用者の画面に返してしまう。

HTMLを組み立てる際の脆弱性なので、サーバー側で対策を行う。

意図しないスクリプトを実行しないようにサニタイジング処理を実施する。

| 入力値 | 置換文字 |
| ------ | -------- |
| &      | &amp;amp |
| <      | &lt      |
| >      | &gt      |
| "      | &quot    |
| '      | &#39;    |

※置換文字側は最後に";"があります

#### 格納型XSS

格納型XSSは反射型XSS同様サーバーの脆弱性をつく攻撃。

スクリプトの文字列をサーバーで永続的に保持する→永続的に保存するため”永続型"

アクセスするユーザが閲覧するたびに攻撃に合う。

#### DOM-BASE XSS

DOMベース型XSSはブラウザで実行するJavaScriptを利用したXSS。

反射型XSSや格納型XSSとは異なり、サーバーを経由しないため

1.攻撃者が悪意あるサイトやメール本文に、悪意あるリンクを準備。利用者がクリックするのを待つ。※リンクの文字列に#悪意あるスクリプトのような形で埋め込みがある

2.利用者がリンクをクリックするのを待つ

3.リンクにアクセスし、レスポンスが返ってくる

4.クライアントでレスポンス中のjava scriptを実行

5.悪意あるスクリプトを取り込み実行してしまう

#### SQLインジェクション

SQLインジェクションもWebアプリケーションが攻撃の対象となる

利用者の入力に対して動的にHTMLページを生成するWebアプリケーションが攻撃対象

入力された項目を使ってSQLを組み立てて実行→入力チェックが甘い場合に意図しないSQL文が実行される

結果、管理者パスワードが漏洩したり、変更されてアクセスされたりする。

６つのパーツよりSQLを組み立てている

SQLインジェクションは埋め込みSQLを利用できる言語ならどんな言語にも発生の可能性がある

Java、C++、ECMAScript、Perl、PHPなど多くの言語で対策必要

①サニタイジング

②バインド機構

バインド機構とは、プレースホルダ＋埋め込むAPIを利用してSQLを組み立てる機能

#### バッファーオーバーフロー

確保しているメモリエリアの大きさを無視した書き込みが可能という脆弱性が存在する

スタック領域にリターンアドレスを退避して実行すうｒ

メモリエリアを確保しプログラムを実行するので、確保してエリアを超えたデータがメモリエリアに渡されるとリターンアドレスまで書き換えることとなる。

そそいて、オーバーフロー部に不正なプログラムのアドレスを入れておくと、不正なプログラムが実行される。
バッファーオーバーフローの脆弱性を持つ関数は、特徴がある。
書き込み先のバッファサイズを指定する引数を指定できない→基本的に上位のセキュアな関数が用意されているので、古いバージョンは使わないようにすること。

#### 対策
1. バッファの大きさを無視した書き込みが可能な関数は使用しない
2. プログラムの中でデータをメモリエリアに転記する際にメモリサイズをチェックするようにコーディングする

#### スタックバッファオーバーフロー
ローカル変数や関数の引数、リターンアドレスなどを格納するメモリーの領域をスタック領域
スタックという名の通り、後入れ先出し(LIFO：Last In First Out)のデータ構造
スタックバッファオーバーフローはスタック領域にあるバッファが溢れること
一般的な対策はバッファのサイズ以上の入力を読み込まないなどが考えられますが、そういった対策を怠った場合に発生する脆弱性

```C++
// C言語における脆弱性のあるコードのイメージ
char buf[64];
gets(buf);    // 64バイト以上でオーバーフロー
// 対策例：fgets(buf, 64, stdin)
```

攻撃者がシェルコードと呼ばれるコンピューターの制御を奪うためのコードを配置した場所にリターンアドレスが指すように書き換えている様子
![alt text](image/{5074BD9D-6F52-4637-9232-856442C2C335}.png)

##### ASLR
Address Space Layout Randomizationの略称
スタック領域等のアドレスをランダム化することで攻撃の成功率を下げるという防御機能
シェルコードが配置される場所を特定することを難しくすることで攻撃の成功率を下げています。
![alt text](image/{21B37D1E-7E2F-4F06-B7E8-F54C176DA44A}.png)

