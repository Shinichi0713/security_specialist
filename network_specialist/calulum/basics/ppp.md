PPP（Point-to-Point Protocol）とは、その名の通り **「2点間（1対1）」でコンピュータを接続して通信を行うためのプロトコル** です。

OSI参照モデルでは **第2層（データリンク層）** に位置します。
かつてのダイヤルアップ接続やADSL、そして現代の光回線の一部でも「通信を開始するための手続き」として重要な役割を担っています。

## PPPについて
### 1. PPPができる前の課題と、PPPの誕生

PPPが登場する前は「SLIP」というプロトコルが使われていましたが、これには「パスワードによる認証ができない」「IPアドレスを自動で割り振れない」といった欠点がありました。

これらを解決し、 **「安全に、かつ自動設定で1対1の通信を確立する」** ためにPPPが作られました。

### 2. PPPの主な3つの機能

PPPは単にデータを運ぶだけでなく、以下の3つのステップを踏むことで通信を成立させます。

1. **リンク確立（LCP: Link Control Protocol）**
「通信条件の交渉」です。パケットの最大サイズや、どの認証方式を使うかといったルールを2点間で決めます。

>__リンクとは__  
>「2つの機器の間でデータをやり取りできる、論理的な通り道（接続状態）のこと。
>物理的なケーブルがつながっているだけでなく、お互いが「通信できる準備が整った状態」にすることを「リンクを確立する」と言います。
>- 物理リンク（Physical Link）: LANケーブルや電話線、光ファイバーなどで物理的に機器同士が結ばれていること。あるいは、無線で電波が届いている状態です。
>- 論理リンク（Logical Link）: 物理的につながっている線の上で、お互いが共通のルール（プロトコル）に基づいて、「今からデータを送受信しますよ」という合意が取れている状態です。


2. **認証（PAP / CHAP）**
「IDとパスワードの確認」です。接続を許可されたユーザーかどうかをチェックします。
* **PAP:** IDとパスワードをそのまま送る（危険）。
* **CHAP:** 暗号化して送る（安全）。


3. **ネットワーク設定（NCP: Network Control Protocol）**
「IPアドレスなどの割り当て」です。通信に必要なIPアドレスを相手から自動的に取得します。


### 3. PPPの「進化形」：PPPoEとPPPoA

PPPは本来「電話線で1対1」を想定していましたが、イーサネット（LAN）やADSLの普及に合わせて、以下のような派生規格が登場しました。

* **PPPoE (PPP over Ethernet):**
イーサネット（LANケーブル）の上でPPPを動かす技術です。現代の**フレッツ光**などの回線で、プロバイダに接続する際によく使われています。ルーターの設定画面で見かける「接続ユーザー名」と「パスワード」は、このPPPoEのためのものです。
* **PPPoA (PPP over ATM):**
ADSLなどで使われていたATMという技術の上でPPPを動かす方式です。

>__イーサネット__  
>イーサネット（Ethernet）とは、世界で最も普及している **「有線LAN（ローカル・エリア・ネットワーク）の標準規格」** のことです。
>私たちが普段、パソコンに「LANケーブル」を差し込んでインターネットをしたり、オフィス内で複数のPCを繋いだりする際に使われている技術の正体が、このイーサネットです。


### 4. 現代における立ち位置：IPoEへの交代

長らく「ネット接続といえばPPPoE」でしたが、最近の光回線（特に10Gbpsなどの高速回線）では、PPPを使わない **IPoE（IP over Ethernet）** という方式が普及しています。

* **PPPoE:** 接続に「ID/パスワード」が必要。トンネルを通るような仕組みのため、混雑しやすい。
* **IPoE:** 「ID/パスワード」が不要。よりシンプルで高速な接続が可能（IPv6通信の主流）。

## PPPのフレーム
PPPのフレーム構成は、データを確実に届けるための「封筒」のような形をしています。
PPPはHDLC（High-level Data Link Control）という古典的なプロトコルをベースにしており、非常にシンプルで洗練された構造が特徴です。

標準的なPPPフレームのフィールド構成は以下の通りです。

### PPPフレームの各フィールド詳細

| フィールド名 | サイズ | 役割・内容 |
| --- | --- | --- |
| **フラグ (Flag)** | 1バイト | **「ここからフレーム開始」**の合図。値は `0x7E` (01111110) で固定。 |
| **アドレス (Address)** | 1バイト | 本来は宛先を示すが、1対1通信なので常に **`0xFF` (ブロードキャスト)**。 |
| **制御 (Control)** | 1バイト | 順序制御などをしない「非番号制フレーム」を示す **`0x03`** で固定。 |
| **プロトコル (Protocol)** | **2バイト** | **中身が何かを識別する最重要項目。** (例: IPなら `0x0021`, LCPなら `0xC021`) |
| **データ (Payload)** | 可変 | 運搬するメインのデータ（IPパケットなど）。最大1500バイト程度。 |
| **FCS (Frame Check Sequence)** | 2 or 4バイト | データが壊れていないかを確認するためのエラーチェック用コード。 |
| **フラグ (Flag)** | 1バイト | **「ここでフレーム終了」**の合図。開始と同じ `0x7E`。 |


### フレームの特徴

#### 1. プロトコルフィールドの存在

PPPの最大の特徴は、この**プロトコルフィールド**にあります。
これにより、1つのリンク上で「IPパケット」を運びながら、同時に「リンク管理用のLCPパケット」や「認証用のCHAPパケット」を混ぜて送ることができます。
※有線のイーサネットでいう「タイプフィールド」と同じ役割です。

#### 2. 固定値が多い理由

アドレス(`0xFF`)と制御(`0x03`)が常に固定されているのは、PPPが「1対1」の通信を前提にしているからです。
「相手は一人しかいないから、細かい宛先指定は不要」という割り切った設計になっています。

#### 3. フレームの「透明性」を保つ工夫（エスケープ処理）

もし、データの中に偶然フラグと同じ `0x7E` という数値が含まれていたらどうなるでしょうか？受信側はそこでデータが終わったと勘違いしてしまいます。
これを防ぐために、PPPではデータの中の `0x7E` を `0x7D 0x5E` という別のパターンに置き換えて送る **「制御文字エスケープ」** という処理を行っています。


### PPPoE（光回線）の場合

現代の光回線で使われる **PPPoE** では、このPPPフレームがさらに「イーサネットフレーム」の中にカプセル化（梱包）されます。

このとき、PPPoEヘッダ（6バイト）とPPPヘッダ（2バイト）の計8バイトが追加されるため、私たちが通信できる実質のデータサイズ（MTU）が、通常の1500バイトから**1492バイト**に減ってしまうという現象が起きます。

## PPPの通信手順

PPP（Point-to-Point Protocol）の通信手順は、非常に几帳面なプロセスを踏みます。ただ繋ぐだけでなく、「お互いの条件をすり合わせ、身元を確認し、最終的に使える状態にする」という**4つのフェーズ**で進行します。


### 1. リンク確立フェーズ (Link Establishment)

物理的な接続（電話線の接続や光回線のリンクアップ）ができると、まず **LCP (Link Control Protocol)** というプロトコルが動き出します。

* **何をするか:** 通信の「基本ルール」を交渉します。
* **交渉内容:** 「パケットの最大サイズ（MRU）は？」「認証は必要か？」「どの認証方式（PAP/CHAP）を使うか？」など。
* **ゴール:** お互いに「Configure-Ack（了解）」を出し合えば、このフェーズは完了です。

### 2. 認証フェーズ (Authentication)

リンクが確立されると、次は「あなたは誰？」を確認するステップに入ります。

※LCPの交渉で「認証なし」となった場合は省略されます。

* **PAP (Password Authentication Protocol):** ユーザー名とパスワードをそのまま送る方式。シンプルですが、盗聴に弱いため現在はあまり使われません。
* **CHAP (Challenge Handshake Authentication Protocol):** 「チャレンジ」と呼ばれるランダムな値をやり取りし、パスワードそのものは送らずに計算結果（ハッシュ値）だけを照合する安全な方式。

### 3. ネットワーク層プロトコル設定フェーズ (Network Layer Protocol)

身元が確認できたら、実際に通信（IPパケットのやり取り）ができるように **NCP (Network Control Protocol)** が動きます。

* **何をするか:** IPアドレスなどのネットワーク設定を行います。
* **IPCP (IP Control Protocol):** PPPの中で最も一般的なNCPで、相手（プロバイダ側）から自分に対して**IPアドレスを割り当ててもらう**ためのやり取りをします。
* **ゴール:** IPアドレスが決まれば、ようやくインターネットが利用可能な状態（Opened）になります。

### 4. リンク終了フェーズ (Link Termination)

通信を終える際の手順です。

* **何をするか:** **LCP** が「終了リクエスト」を送り、相手が「了解」を返すと、論理的なリンクが閉じられます。
* **きっかけ:** ユーザーによる切断操作や、一定時間通信がない（タイムアウト）、あるいは物理的な切断（回線が抜ける）など。


## 現在の開発の方向性

PPP（Point-to-Point Protocol）のような2点間通信は、現在、単なる「1対1の接続」を超えて、 **「仮想化」「超高速化」「高セキュリティ化」** という3つの大きな方向で技術開発が進んでいます。

現代のネットワークでは、物理的な1対1の線だけでなく、複雑なネットワークの中に **「論理的な2点間のトンネル」** を作る技術が重要視されています。


### 1. IPoEとSD-WAN（PPPからの脱却と仮想化）

かつてのPPP（PPPoE）は、接続地点でボトルネックになりやすいという欠点がありました。現在は、より効率的な接続方式が普及しています。

* **IPoE (IP over Ethernet):** PPPを使わずに、イーサネット上で直接IP通信を行う方式です。プロバイダとの接続時に認証の手間を省き、大容量通信をスムーズにします。
* **SD-WAN (Software-Defined WAN):** 地理的に離れた拠点を「1対1」の感覚でつなぐ技術です。物理的な回線はインターネットであっても、ソフトウェア制御で仮想的な2点間リンクを構築し、通信経路を最適化します。

### 2. SRv6 (Segment Routing IPv6)

現在、次世代のバックボーンネットワークで最も注目されている技術の一つです。

* **仕組み:** 従来のPPPが「トンネルという土管を1本作る」イメージだったのに対し、SRv6はパケット自体に「どこを経由してどこへ行くか」という全行程を書き込みます。
* **メリット:** 複雑な網目状のネットワークの中で、特定の2点間を最短・最速でつなぐ「論理的な専用パス」を柔軟に作ることができます。


### 3. 光トランスポートネットワークの超高速化 (OTN)

物理層に近いレベルでの2点間通信（データセンター間など）では、光ファイバーの限界に挑む開発が進んでいます。

* **400G/800G Ethernet:** 物理的な2点間で、一度に400Gbpsや800Gbpsという超巨大量のデータを送る技術です。
* **コヒーレント光通信:** 光の「振幅」だけでなく「位相（波のズレ）」も利用して情報を載せることで、1本の光ファイバーで送れる容量を劇的に増やしています。

### 4. 量子鍵配送 (QKD) による究極の2点間セキュリティ

「2点間通信の内容を絶対に盗ませない」ための究極の技術開発です。

* **仕組み:** 量子力学の性質を利用し、2点間で「暗号鍵」を共有します。もし第三者が盗聴（観測）しようとすると、量子状態が変化するため、盗聴を確実に検知できます。
* **現状:** 金融機関や政府機関など、極めて機密性の高い拠点間通信での実用化に向けた実験が世界中で進んでいます。


### 5. 通信プロトコルの進化 (QUIC)

OSI参照モデルの上位層でも、2点間のやり取りを効率化する動きがあります。

* **QUIC:** Googleが開発し、現在は標準化されているプロトコルです。UDPをベースに、PPPやTCPで行っていた「接続の確立（ハンドシェイク）」を極限まで簡略化し、通信開始のレイテンシ（遅延）を劇的に短縮しています。



