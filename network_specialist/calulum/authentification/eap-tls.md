普段仕事でPCを起動して、社内LANになんとなく接続されています。
実はその時に、PCが誰なのか、接続してよいのかを、ネットワーク側で判断しています。
この時に使われる手法として主流である EAP-TLSについて説明します。


### EAP-TLSとは？
EAP-TLS（Extensible Authentication Protocol-Transport Layer Security）とは、Wi-Fiや有線LANの認証において、 **「電子証明書」を用いて非常に強固な身元確認を行う規格** です。

主に企業のネットワーク（WPA2/WPA3エンタープライズ）で採用されており、IDやパスワードによる認証よりもはるかに高いセキュリティを実現します。


### EAP-TLSの最大の特徴

最大のポイントは、 **「クライアント（PCやスマホ）」と「認証サーバー」の両方がデジタル証明書を持ち、お互いが本物であることを確認する（相互認証）** 点にあります。

* **パスワードが不要:** IDとパスワードを入力する代わりに、デバイス内にインストールされた証明書を使います。
* **なりすましが困難:** 証明書はデバイスから取り出せないように設定できるため、パスワードのように「盗み見られて別の端末からログインされる」リスクがほぼありません。
* **TLSを利用:** インターネットの暗号化通信（HTTPS）で使われているTLSプロトコルを、ネットワーク接続時の認証に応用しています。


### 認証の仕組み（3者の登場人物）

EAP-TLSでは通常、以下の3つの要素が連携して動きます。

1. **サプリカント（クライアント）**: PCやスマホ。自分の証明書を提示します。
2. **オーセンティケータ（アクセスポイント/スイッチ）**: 認証の仲介役。
3. **認証サーバー（RADIUSサーバー）**: 証明書が正しいか、有効期限が切れていないかを判定する「裁判官」のような役割。

### EAP-TLSのメリットとデメリット

| メリット | デメリット |
| --- | --- |
| **最強クラスのセキュリティ**: 証明書がないデバイスは物理的に接続を拒否されます。 | **運用の手間**: デバイス一台ごとに証明書を発行・インストールする手間がかかります。 |
| **ユーザーの負担軽減**: 一度設定すれば、パスワードの定期変更や再入力が不要です。 | **証明書の有効期限管理**: 期限が切れると突然繋がらなくなるため、更新管理が必須です。 |
| **パスワード漏洩のリスクゼロ**: 通信経路上にパスワードが流れないため、盗聴の心配がありません。 | **CA（認証局）の構築**: 証明書を発行するためのサーバー（PKI）を構築・維持する必要があります。 |


### 他のEAP方式との違い

EAPにはいくつか種類がありますが、EAP-TLSはその中でも最も厳格です。

* **EAP-PEAP / EAP-TTLS**: サーバー側だけが証明書を持ち、ユーザー側はID/パスワードで認証する方式。（証明書配布の手間が省けるが、パスワード漏洩リスクは残る）
* **EAP-TLS**: **双方が証明書を持つ。** 最も手間はかかるが、最も安全。


### クライアント証明書の受け渡し

EAP-TLSで最も重要となる「クライアント証明書」を、個々のデバイス（クライアント）がどのように取得するかには、いくつかのパターンがあります。

組織の規模や管理の厳格さによって異なりますが、主に以下の3つのルートで配布されます。


#### 1. MDM（モバイルデバイス管理）による自動配布

現在の企業ネットワークで最も一般的な方法です。**Microsoft Intune**や**Jamf**、**BizMobile**などのMDMツールを使用します。
多くの方はこちらでは、というより。そんなやり取りしていることに気づかないユーザ様の方が多数と思います。

* **仕組み:** 管理者がクラウド上の管理画面で設定を作成すると、ネットワーク経由で各デバイスに証明書が「降ってくる」仕組みです。
* **メリット:** ユーザーは何の操作もせず、気づいたらWi-Fiに繋がる状態になっています。
* **技術:** SCEP（Simple Certificate Enrollment Protocol）というプロトコルを使い、デバイスが自ら証明書を発行要求し、自動的にインストールされます。

#### 2. 証明書配布専用の「受取サイト」から取得

ユーザーがブラウザを使って、自分自身で取得する方法です。

* **手順:** 1. 管理者から案内された専用サイト（ユーザーポータル）にログインする。
2. 「証明書を発行する」ボタンを押すと、証明書ファイル（.p12や.pfx）がダウンロードされる。
3. ダウンロードしたファイルを開き、OSの証明書ストアにインストールする。
* **用途:** MDMを導入していない組織や、個人の持ち込みPC（BYOD）を一時的に許可する場合に使われます。

#### 3. 管理者による手動インストール

最も原始的で、かつ最も確実な方法です。

* **手順:** 管理者が認証局（CA）で証明書を作成し、USBメモリやメールなどを介してデバイスにコピーし、手作業で設定します。
* **用途:** 接続するデバイスの数が非常に少ない場合や、極めて高いセキュリティが求められ、ネットワーク経由の配布すら禁止されている場合に行われます。


### クライアント証明書の保管場所

取得した証明書は、単なるファイルとしてハードディスクに置かれるのではなく、OSの安全な領域（ **証明書ストア** ）に保管されます。

* **Windows:** 「証明書マネージャー（certmgr.msc）」で管理。
* **macOS/iOS:** 「キーチェーン」で管理。
* **Android:** 「セキュリティ設定」内の「資格情報ストレージ」で管理。

> **ポイント：TPMの活用**
> 最近のビジネスPCには **TPM (Trusted Platform Module)** というセキュリティチップが搭載されています。証明書を取得する際、このチップ内で「秘密鍵」を生成することで、たとえPCが盗まれても証明書だけを外部にコピー（エクスポート）できないようにガードしています。

### 実際の処理

EAP-TLSを実施するためには、通信を行うデバイス（クライアント）だけでなく、ネットワーク機器や認証サーバーが連携して動作する必要があります。

有線LANでも無線LANでも、基本的な役割分担は **「サプリカント」「オーセンティケータ」「認証サーバー」** の3者間で行われます。


### 1. ネットワークを構成する3つの要素

| 役割（用語） | 具体的な機器 | EAP-TLSでの仕事 |
| --- | --- | --- |
| **サプリカント** | PC、スマホ、タブレット | 自分の**クライアント証明書**を提示する。 |
| **オーセンティケータ** | **Wi-Fiアクセスポイント**、**L2スイッチ** | 認証が通るまで通信を遮断し、認証パケットだけを中継する。 |
| **認証サーバー** | **RADIUSサーバー** | 証明書が本物か、失効していないかを検証する「心臓部」。 |


### 2. 実施される際の流れ（シーケンス）

有線でも無線でも、接続した瞬間に以下のやり取りがバックグラウンドで行われます。

1. **接続検知**: LANケーブルの接続やWi-FiのSSID選択を検知。
2. **EAP開始**: オーセンティケータが「Identity（君は誰？）」と問いかけ、クライアントが「EAP-TLSでいきます」と答えます。
3. **TLSハンドシェイクの開始**: ここからがEAP-TLSの本番です。
* サーバーが「サーバー証明書」を提示（クライアントは偽サーバーでないか確認）。
* クライアントが「クライアント証明書」を提示（サーバーは許可された端末か確認）。


4. **相互認証完了**: お互いの証明書が正しいと分かれば、認証成功のパケットが送られます。
5. **ポートの開放**: オーセンティケータ（スイッチやAP）が、その端末の通信を許可（ポートをOPEN）します。


### 3. 無線LAN（Wi-Fi）での実施特徴

無線の場合、WPA2/WPA3の「**エンタープライズ（Enterprise）モード**」設定を使用します。

* **暗号化鍵の生成**: EAP-TLSの認証プロセスの中で、そのセッション専用の暗号化鍵（PMK/PTK）が自動的に生成されます。
* **メリット**: 家庭用のWi-Fi（パーソナルモード）のように全員共通のパスワード（PSK）を使わないため、誰かがパスワードを漏洩させる心配がありません。

### 4. 有線LANでの実施特徴

有線の場合、　**IEEE 802.1X（エドットエックス）**　という規格に基づいて実施されます。

* **物理ポートの制御**: 認証されていないPCをLANケーブルで繋いでも、スイッチのポートが論理的に閉じており、一切の通信（IPアドレスの取得すら）ができません。
* **MACアドレス認証との違い**: MACアドレスは偽装が可能ですが、EAP-TLSは「秘密鍵」を持つ端末しか通さないため、不正なPCの持ち込みを物理レベルで完全に防げます。


### 5. 実施に必要な「準備物」

EAP-TLSを動かすには、以下のインフラ構築が必要です。

* **PKI（公開鍵基盤）**: 証明書を発行・管理するための認証局（CA）。
* **RADIUSサーバー**: FreeRADIUSやWindows ServerのNPSなど。
* **802.1X対応機器**: エンタープライズ向けのスイッチやアクセスポイント。


