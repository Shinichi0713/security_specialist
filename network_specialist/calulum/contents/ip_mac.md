IPパケットとMACフレームの関係は、一言で言うと **「中身（手紙）」と「封筒（パッケージ）」** の関係です。

ネットワーク通信では、データが階層を移動するごとに新しい情報で包まれる **「カプセル化」** というプロセスが行われます。


### 1. 役割の違い：誰がどこへ届けるか？

* **IPパケット（第3層：ネットワーク層）**
* **役割:** 最終目的地（エンド・ツー・エンド）までの配達。
* **住所:** IPアドレス（例：192.168.1.1）。
* **イメージ:** 手紙の便箋に書かれた「東京都◯◯様」という**最終的な宛先**。


* **MACフレーム（第2層：データリンク層）**
* **役割:** 隣り合う機器（ホップ・バイ・ホップ）への配達。
* **住所:** MACアドレス（例：00:1A:2B...）。
* **イメージ:** 郵便局の間で使われる **「次の配送拠点」が書かれたカゴや袋** 。



### 2. 構造の関係性（カプセル化）

データが送信されるとき、IPパケットはMACフレームの中に「荷物（ペイロード）」として丸ごと詰め込まれます。

1. **IPパケットの作成:** データの前に「宛先IP」などの**IPヘッダ**がつきます。
2. **MACフレームへの格納:** そのIPパケットを包むように、さらに外側へ「宛先MACアドレス」などの**MACヘッダ**と、エラー検知用の**FCS（トレーラ）**がつきます。

イーサネットの場合、この完成形が「イーサネットフレーム（MACフレーム）」として物理的なケーブルへ送り出されます。


### 3. 通信中の変化：書き換わるか、変わらないか

ここが最も面白いポイントです。通信が進むにつれて、この2つには大きな違いが出ます。

* **IPパケットは「変わらない」:**
送信元から受信先に届くまで、IPヘッダに書かれた宛先IPアドレスは基本的に書き換わりません（NATなどを除く）。
* **MACフレームは「次々に書き換わる」:**
ルーターを通過するたびに、MACフレームは一度壊され、新しい「次の隣の機器」を宛先にしたMACフレームに作り直されます。


### 4. まとめ：なぜ両方必要なのか？

* **IPパケットだけでは:** 物理的なケーブル上をどう流れるか、隣のルーターのどのアシ（ポート）に届けるべきかが分かりません。
* **MACフレームだけでは:** 世界中のネットワークをまたいで、最終的にどのPCに届けるべきかのルート案内ができません。

この2つが**「二重構造」**になっているおかげで、インターネットという巨大な網目の中でも、迷子にならずにデータが届くのです。


### まとめ表

| 比較項目 | IPパケット | MACフレーム |
| --- | --- | --- |
| **OSI参照モデル** | 第3層（ネットワーク層） | 第2層（データリンク層） |
| **主な識別子** | IPアドレス（論理住所） | MACアドレス（物理住所） |
| **有効範囲** | インターネット全体（最終目的地まで） | 隣り合う機器間（1ホップ） |
| **変化** | 原則として最後まで不変 | ルーターを越えるたびに書き換わる |

## IPv6

IPv4とIPv6の最も大きな違いは、**「扱えるアドレスの数（インターネット上の住所の数）」**です。

IPv4は1980年代に作られた規格ですが、インターネットの普及によりアドレスが足りなくなってしまった（枯渇した）ため、ほぼ無限に近いアドレスを使えるように設計されたのがIPv6です。

主な違いを、重要なポイントに絞って解説します。

---

### 1. アドレスの長さと数（圧倒的な差）

* **IPv4:** 32ビット。約 **43億個**。
* 世界人口よりも少ないため、今の時代では全く足りません。


* **IPv6:** 128ビット。約 **340兆の1兆倍の1兆倍（340澗）個**。
* 「地球上の砂粒ひとつひとつにアドレスを割り当てても余る」と言われるほど膨大です。



[Image comparing IPv4 address format (dotted decimal) and IPv6 address format (hexadecimal)]

---

### 2. 表記方法

見た目も大きく変わりました。

* **IPv4:** 10進数をドットで区切る（例: `192.168.1.1`）
* **IPv6:** 16進数をコロンで区切る（例: `2001:0db8:85a3:0000:0000:8a2e:0370:7334`）
* 0が続く部分は `::` と省略できるルールがあります。



---

### 3. 通信速度と接続方式（日本での大きなメリット）

技術的な仕様そのものよりも、日本においては**「接続方式の違い」**でIPv6の方が速いと感じることが多いです。

* **IPv4 (PPPoE方式):** 従来の接続方法。プロバイダの「網終端装置」という場所が混雑しやすく、夜間に速度が落ちる原因になります。
* **IPv6 (IPoE方式):** 新しい接続方法。混雑する場所を避けて通信できる「次世代の専用道路」を通るため、時間帯によらず高速で安定した通信が可能です。

---

### 4. 設定の自動化（プラグアンドプレイ）

* **IPv4:** DHCPサーバーなどがないと、自分でIPアドレスを設定するのは少し手間でした。
* **IPv6:** **「ステートレスアドレス自動設定 (SLAAC)」**という機能があり、ルーターに繋ぐだけでデバイスが自分で自分のアドレスを生成して通信を始められます。

---

### 5. セキュリティ (IPsec)

* **IPv4:** セキュリティ機能（IPsec）は、後から「追加」されたオプションでした。
* **IPv6:** 設計段階からセキュリティ機能が盛り込まれており、より安全な通信の土台が整っています。

---

### 比較表まとめ

| 項目 | IPv4 | IPv6 |
| --- | --- | --- |
| **アドレス長** | 32ビット | 128ビット |
| **アドレス数** | 約43億個 | ほぼ無限 (340澗個) |
| **表記** | 10進数 (192.168...) | 16進数 (2001:db8...) |
| **自動設定** | DHCPが必要 | 標準機能で自動設定可能 |
| **日本での速度** | 混雑しやすい(PPPoE) | **高速・安定(IPoE)** |

---

### まとめ

IPv4は**「工夫して使い続けてきた古い規格」**であり、IPv6は**「これからのインターネットを支える、広くて快適な最新の規格」**です。

現在は、IPv4しか使えないサイトとIPv6が使えるサイトが混在しているため、両方を同時に利用する「デュアルスタック」という仕組みが一般的になっています。

**次は、IPv6を使っているのになぜかIPv4のサイトも見られる魔法のような技術「IPv4 over IPv6（V6プラスなど）」の仕組みについてお話ししましょうか？**

