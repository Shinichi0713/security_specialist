
## 概要
「IPv4 over IPv6」は、一言でいうと **「最新の空いている道路（IPv6）の中に、古い規格の荷物（IPv4）を詰め込んで一気に運んでしまう」** という技術です。

「v6プラス」や「OCNバーチャルコネクト」といったサービス名で広く知られており、夜間のネットが遅いという問題を解決する切り札として普及しました。


## なぜ「over IPv6」が必要なのか？

これまでのIPv4接続には、大きな弱点がありました。

* **従来のIPv4 (PPPoE方式):** プロバイダにある「網終端装置」というゲートを通る必要があります。ここは道路でいう「料金所」のような場所で、夜間に利用者が増えると大渋滞が発生し、速度が極端に落ちてしまいます。
* **IPv6 (IPoE方式):** 料金所のない「バイパス道路」を通るため、常にスムーズです。

しかし、世の中のWebサイトには「IPv4でしか見られないサイト」がまだたくさんあります。そこで、**IPv4のデータも、混雑している料金所を避けて、空いているIPv6バイパスを通らせてしまおう**と考え出されたのが「IPv4 over IPv6」です。


__IPv4 (PPPoE方式)が遅くなってしまう最大の理由__  

一言でいうと **「設計の古さと、アクセスの集中による『関所（ボトルネック）』のパンク」** です。

具体的にどこが渋滞しているのか、3つのポイントで解説します。

1. 網終端装置（NTE）という名の関所

PPPoE方式で通信する場合、必ずNTTの局舎内にある **「網終端装置（NTE）」** という設備を通る必要があります。

* **設計上の限界:** この装置は、1台あたりに収容できるユーザー数や通信量が厳格に決められています。
* **需要とのギャップ:** 近年、動画配信やテレワークでデータ通信量が爆発的に増えましたが、装置の増設には「セッション数（利用者数）が一定に達しないと増やせない」といった厳しいルールがあるため、需要に対して供給（装置の処理能力）が追いついていません。

その結果、利用者が増える**夜間や休日**に、この装置にデータが殺到して「大渋滞」が起きてしまいます。

2. 「ユーザー認証」の手間

PPPoE（Point-to-Point Protocol over Ethernet）は、もともと電話回線での接続（ダイヤルアップ）に使われていた仕組みを無理やりLAN（イーサネット）に応用したものです。

* **認証プロセス:** 通信を開始するたびに、プロバイダのIDとパスワードを照合して「この人は接続を許可されたユーザーか？」という確認作業を行います。
* **オーバーヘッド:** この認証や通信の制御（カプセル化）に計算資源を割くため、構造上、次に説明する「IPoE方式」に比べてロスが発生しやすくなります。

3. MTU値（データの細切れ）による効率低下

PPPoE方式では、通信の制御データ（ヘッダー）をパケットに含める必要があるため、一度に送れるデータの最大サイズ（MTU）が、通常のLAN規格（1500バイト）よりも小さく設定されています。

* **IPv4 PPPoEのMTU:** **1454バイト**
* **通常のイーサネット:** **1500バイト**

わずかな差に見えますが、大量のデータを送る際には「より細かく分割して送る」必要があるため、その分、転送効率が落ちてしまいます。


## 仕組み


### カプセル化（トンネリング）
"IPv4 over IPv6"の肝は、 **「カプセル化」** という手法です。

1. **自宅のルーター:** あなたのPCが出した「IPv4のパケット」を、そのまま「IPv6のパケット」という封筒に入れます（カプセル化）。
2. **通信経路:** 封筒の宛先はIPv6なので、混雑したIPv4料金所を無視して、空いているIPv6バイパスを高速で駆け抜けます。
3. **VNE（接続事業者）の設備:** バイパスを抜けた先で、封筒（IPv6）を破って、中身の「IPv4パケット」を取り出します。
4. **目的地:** 取り出されたIPv4パケットが、そのままIPv4専用のサイトなどに届けられます。



### 主なメリットとデメリット

| メリット | デメリット・注意点 |
| --- | --- |
| **夜間でも速度が落ちにくい** | 特定のポート番号しか使えない（後述） |
| ルーターを繋ぐだけで設定が完了する | 一部のオンラインゲームでマッチングしにくくなる |
| IPv4とIPv6の両方のサイトが見られる | 固定IPアドレスが使いにくくなる |


### 「ポート制限」という注意点

IPv4 over IPv6（特にMAP-E方式など）では、1つのグローバルIPv4アドレスを複数のユーザーで共有します。

* 通常、1つのIPには65,535個の「ポート（窓口）」がありますが、これをユーザーごとに「あなたは1000番〜2000番を使ってね」と分割して割り振ります。
* そのため、 **「特定のポート番号を必ず使う必要があるサービス」** （一部の格闘ゲーム、自宅サーバーの公開、一部のWebカメラなど）が動かなくなることがあります。



## IPoE接続へ切り替え

IPv6 IPoE接続（IPv4 over IPv6を含む）へ切り替えることで、夜間の速度遅延を劇的に改善できる可能性が高まります。

切り替えには **「回線・プロバイダ側」** と **「ユーザー（ルーター）側」** の両方で条件を満たす必要があります。

### 1. 切り替えるための3つの条件

まずは、ご自身の環境が以下の条件をクリアしているか確認が必要です。

#### ① 回線が「次世代ネットワーク（NGN）」に対応している

NTTのフレッツ光ネクスト、フレッツ光クロス、またはそれらを利用した「光コラボ（ドコモ光、ソフトバンク光、楽天ひかり等）」を契約していれば、基本的に物理的な回線条件はクリアしています。

#### ② プロバイダが「IPv6 IPoEオプション」を提供している

現在契約しているプロバイダで、IPv6 IPoE接続オプション（「v6プラス」「transix」「OCNバーチャルコネクト」など）が有効になっている必要があります。

* 多くのプロバイダでは**無料**ですが、マイページからの「申し込み」が必要な場合があります。
* 「IPv4 over IPv6」の機能が含まれているかを確認してください。

#### ③ 「IPv6 IPoE / IPv4 over IPv6」対応ルーターを用意する

これが最も重要なポイントです。古いルーターや、PPPoEにしか対応していないルーターでは、いくらプロバイダ側がIPv6に対応していても高速通信はできません。


### 2. 失敗しないルーターの選び方

ルーターを選ぶ際は、単に「IPv6対応」と書かれているだけでは不十分です。 **「使用しているプロバイダの接続方式」に対応しているか** が鍵となります。

#### チェックすべき項目：接続方式の名称

プロバイダによって、採用している技術（VNE）が異なります。ルーターのパッケージや仕様表に、以下の名称が記載されているか確認してください。

* **v6プラス**（日本ネットワークイネイブラー）
* **transix**（インターネットマルチフィード）
* **OCNバーチャルコネクト**（NTTレゾナント）
* **クロスパス**（アルテリア・ネットワークス）
* **v6コネクト**（朝日ネット）

> **選び方のコツ:** 最近のバッファロー（Buffalo）、NEC（Aterm）、アイ・オー・データ、TP-Linkなどの主要メーカーの現行モデルであれば、主要な方式をほぼ網羅している「自動判別機能」付きのものが多く、初心者でも安心です。


### 3. ルーター設定時のポイント

新しいルーターを手に入れたら、以下の手順で接続します。

1. **ONU（NTTの黒い装置）と接続:** LANケーブルで繋ぎます。
2. **モード切替スイッチを確認:** ルーター背面のスイッチを「ROUTER」または「AUTO」にします。
3. **自動判別を待つ:** 最近のルーターは、電源を入れて数分待つだけで、自動的に「IPv4 over IPv6」として接続されます。**IDやパスワードの入力（PPPoE設定）は不要です。**（※入力が必要な場合は、まだPPPoE方式で繋ごうとしている証拠です）

>__ONU__  
>光ファイバーからの『光信号』と、PCなどが理解できる『電気信号』を互いに変換する装置です。
>インターネットの入り口に必ず置いてある、NTTなどのロゴが入った黒い箱のことです。
>- ONUの役割：翻訳機のような存在  
>光ファイバーの中を通っているデータは「光」の点滅です。しかし、私たちが使っているPCやルーターは「電気信号（デジタルデータ）」でしか情報を扱えません。
>- モデムやルーターとの違い
>モデム: 「アナログ電話回線」や「ADSL（メタル線）」の信号を変換するもの。光回線の場合は「ONU」がその役割を担います。
>ルーター: ONUから受け取った1つのネット接続を、複数のスマホやPCで同時に使えるように枝分かれさせる装置。Wi-Fiを飛ばすのもルーターの役割です。

### 4. 正しく切り替わったか確認する方法

接続後、ブラウザで **「IPv6 確認」** と検索し、判定サイト（例：[test-ipv6.com](https://test-ipv6.com/)）にアクセスしてみてください。

* **「IPv6アドレス」が表示されている**
* **「IPv4 over IPv6」による接続が確認できる**

この2点がクリアされていれば、設定成功です。

## 今後の展望

IPv4 over IPv6（MAP-EやDS-Liteなど）は、IPv4枯渇問題への「当面の回避策」として非常に完成度の高い技術ですが、ネットワークの研究分野では、その **「さらに先」** を見据えた技術開発が進んでいます。

主な研究・進化の方向性は、 **「運ぶ効率を極限まで高める」「IPv4を完全に切り離す」「モバイル・5Gへの最適化」** の3点に集約されます。


### 1. SRv6 (Segment Routing IPv6) への統合

現在、最も注目されている「IPv4 over IPv6」の進化系が**SRv6**です。

* **これまでの課題:** 従来のトンネリング（カプセル化）は、A地点からB地点へ「ただ運ぶだけ」の単純な土管でした。
* **次世代の姿:** SRv6を使うと、IPv6のパケットの中に「どのルーターを通って、どの処理（セキュリティチェックなど）をしてから届けるか」という指示書（命令）を書き込めます。
* **メリット:** IPv4の通信をただ運ぶだけでなく、「このIPv4通信は低遅延なルートで運ぶ」「この通信は検閲を通す」といった、 **ネットワークスライシング（用途別の最適化）** がIPv6の仕組みだけで完結できるようになります。


### 2. 464XLAT の普及と進化（モバイル分野）

スマホなどのモバイルネットワークでは、すでにIPv4を一切使わない **「IPv6 Single Stack」** 化が進んでいます。

* **研究の方向:** 端末からキャリアのコアネットワークまでを完全にIPv6のみにし、端末内のアプリがIPv4で通信しようとした時だけ、端末内でIPv6に変換（NAT46）して送り出す技術（464XLAT）が主流になりつつあります。
* **究極の目標:** ネットワークの途中に「IPv4用の装置」を一切置かないことで、設備のコストを下げ、故障のリスクを減らす研究が進んでいます。


### 3. 軽量なカプセル化技術（GUE / Geneve）

IPv4 over IPv6で行っている「カプセル化」は、実はルーターにとって計算負荷がかかる作業です。

* **進化:** よりシンプルで高速に処理できる新しいカプセル化プロトコル（GUE: Generic UDP Encapsulationなど）の研究が進んでいます。
* **目的:** クラウドデータセンターなどの超高速な環境において、数テラビット級の通信を遅延なく処理することを目指しています。


### 4. IPv6-only ネットワークへの完全移行（NAT64/DNS64）

「IPv4を運ぶ」ことすらやめて、**「IPv4のサイトを、IPv6のふりをして見せる」**技術の洗練が進んでいます。

* **仕組み:** クライアント側はIPv6しか喋りませんが、ネットワークの出口で「IPv4への翻訳」を高速に行います。
* **研究の焦点:** これまでは一部のアプリが動かなくなるなどの不具合がありましたが、これを100%の互換性に近づけるための「翻訳エンジン」の精度向上が研究されています。




