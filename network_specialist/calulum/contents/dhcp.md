DHCP（Dynamic Host Configuration Protocol）は、PCやスマホがネットワークに接続した際、**「IPアドレス」だけでなく「デフォルトゲートウェイの住所」や「DNSサーバー」などの設定情報をセットで自動取得する**ための仕組みです。

手動で一つひとつ設定する手間を省き、設定ミスを防ぐために欠かせない技術です。

---

### 1. DHCPで取得できる主な情報

DHCPサーバーからは、主に以下の情報がパッケージとして送られてきます。

* **IPアドレス:** その端末自身の論理住所。
* **サブネットマスク:** ネットワークの範囲。
* **デフォルトゲートウェイ:** 外の世界（インターネット）への出口となるルーターのIPアドレス。
* **DNSサーバー:** ドメイン名をIPアドレスに変換してくれるサーバーの住所。

---

### 2. デフォルトゲートウェイ取得の重要性

デフォルトゲートウェイのアドレスが取得できないと、同じLAN内の通信はできても、**インターネット（外部ネットワーク）には一切つながりません。**

* 端末は、宛先IPを見て「これは外の世界の住所だ」と判断すると、パケットをデフォルトゲートウェイ（ルーター）に丸投げします。
* DHCPによってこの「投げ先」を自動で教わることで、ユーザーは何も設定せずにブラウザを開くだけでネットが使えるようになります。

---

### 3. DHCPの4ステップ（DORAプロセス）

端末が起動してから設定を取得するまで、以下の4つのやり取りが行われます。

1. **Discover（発見）**: 端末が「誰かIPアドレスを貸して！」と**ブロードキャスト**で叫びます。
2. **Offer（提案）**: DHCPサーバーが「このIPアドレスと、このゲートウェイ（ルーターの住所）はどう？」と提案します。
3. **Request（要求）**: 端末が「その設定を使わせてください！」と正式に申し込みます。
4. **Acknowledge（確認）**: サーバーが「了解！貸し出し期間はこれくらいだよ」と承認し、設定が完了します。

---

### 4. DHCPリレーエージェント（ルーターを越える場合）

本来、DHCPの「Discover」はブロードキャストなので、ルーター（ゲートウェイ）を越えて別のネットワークには届きません。

しかし、大きな組織では1台のDHCPサーバーで全拠点を管理したい場合があります。その際、ルーターが「DHCPリレーエージェント」として働き、端末の叫び声を拾って、遠くにあるDHCPサーバーまで転送（ユニキャストに変換）してくれます。

---

### まとめ

* **DHCP**は、IPアドレスやゲートウェイなどの設定を自動で配る仕組み。
* **デフォルトゲートウェイ**の情報が含まれているからこそ、私たちは「繋ぐだけ」で外の世界と通信できる。
* **DORA（Discover, Offer, Request, Ack）**という手順で、確実な貸し出しが行われている。


