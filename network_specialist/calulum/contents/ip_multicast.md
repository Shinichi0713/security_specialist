## IPマルチキャスト
IPマルチキャストが必要な最大の理由は、**「ネットワークの帯域（道路の幅）とサーバーの負荷を劇的に節約しながら、多人数へ同時にデータを届けるため」**です。

もしマルチキャストがなかったら、現在のYouTube Liveのような数万人規模の同時視聴や、リアルタイムの株価配信は、ネットワークがパンクして成立しなくなってしまいます。

具体的に「なぜ必要なのか」を3つの視点で解説します。


### 1. ネットワーク帯域の爆発的な節約

同じ動画（例えば10MbpsのHD映像）を100人に届ける場面を想像してみてください。

* **ユニキャストの場合（1対1）:**
サーバーは100回同じデータを送らなければなりません。合計で **1,000Mbps（1Gbps）** の帯域を消費します。
* **マルチキャストの場合（1対多）:**
サーバーはデータを **1回だけ** 送り出します。途中のルーターが必要な場所でだけデータを「コピー」して分岐させるため、ネットワークを流れるデータ量は **10Mbps** のままで済みます。

### 2. 送信元サーバーの負荷軽減

ユニキャストで多人数に送る場合、サーバーのCPUやメモリは「100人分の接続管理」に追われ、接続数が増えるほどパンクしやすくなります。
マルチキャストであれば、サーバー側は「誰が聞いているか」を個別に管理する必要がなく、ただ1つの宛先に投げ続けるだけでよいため、受信者が10人でも100万人でもサーバーの負荷はほとんど変わりません。

### 3. 「リアルタイム性」の確保

ユニキャストの場合、サーバーが順番にデータを送るため、1人目と10,000人目ではデータが届く時間にわずかな「時差」が生じることがあります。
マルチキャストはネットワーク全体に一斉に波及するため、全員がほぼ同時に情報を受け取ることができます。これは、1秒を争う金融取引のデータ配信などで極めて重要です。


### ユニキャスト・ブロードキャスト・マルチキャストの比較

| 項目 | ユニキャスト | ブロードキャスト | マルチキャスト |
| --- | --- | --- | --- |
| **効率性** | 低い（人数分送る） | 低い（全員に強制） | **高い（必要な分だけ複製）** |
| **対象** | 1人 | 全員 | **特定のグループ** |
| **負荷の場所** | サーバーに集中 | 全端末に波及 | **ルーターが賢く分散** |

### マルチキャストアドレスの種類
224.0.0.0～238.255.255.255はIANAが管理するアドレス範囲。
224.0.0.0はリンクローカルマルチキャストアドレス。

>__IANA__  
>**IANA（Internet Assigned Numbers Authority：アイアナ）**は、インターネット上で使われるあらゆる「番号」や「識別子」を、世界レベルで一元管理している機関です。
>インターネットは、世界中のコンピュータが同じルール（プロトコル）で通信することで成り立っています。もし、同じIPアドレスやポート番号が複数の場所で勝手に使われたら、通信は大混乱に陥ってしまいます。IANAはそうした事態を防ぐための「総元締め」の役割を果たしています。

### まとめ

IPマルチキャストは、**「情報のコピー作業を、送信元ではなく、ネットワークの分岐点（ルーター）に任せる」**という仕組みです。これによって、インターネットという限られた資源を無駄にせず、リッチなコンテンツを大勢の人に届けることが可能になっています。

## PIM

**PIM（Protocol Independent Multicast）**は、ネットワーク上でマルチキャストパケットを「どのルートで転送するか」を決定するためのルーティングプロトコルです。

一言でいうと、**「マルチキャスト専用の効率的な配送ルート（ツリー）を作る指揮官」**のような存在です。


### 1. PIMが解決しようとした課題

PIMが登場する前にもマルチキャスト用のプロトコルはありましたが、大きな課題がありました。PIMはそれを解決するために設計されました。

#### ① 「特定のユニキャストプロトコル」に依存していた

以前のプロトコル（DVMRPなど）は、特定のユニキャストルーティングの仕組みをセットで使う必要がありました。

* **PIMの解決策:** 名前の通り「Protocol Independent（プロトコルに依存しない）」であること。RIP、OSPF、BGPなど、**どんなユニキャストプロトコルが動いていても、その情報を利用して動作できる**ようにしました。

#### ② ネットワーク全体の帯域を浪費していた

初期の手法では、「とりあえず全員に送ってみて、いらない人だけ断ってもらう（フラッディング）」という方式でした。これでは、受信者がいない場所にもデータが流れてしまいます。

* **PIMの解決策:** ネットワークの密度（受信者が多いか少ないか）に合わせて、**2つの動作モード（DenseとSparse）**を使い分けられるようにしました。


### 2. PIMの2つのモード

PIMは、受信者の分布状況によって戦術を切り替えます。

#### PIM-DM（Dense Mode：稠密モード）

* **想定:** 「みんなこのデータが欲しいはずだ」という状況。
* **動き:** 最初に全ルーターにパケットを流し（プッシュ型）、不要なルーターから「うちは要らない」という通知（Prune）を受け取って経路を削ります。
* **課題:** 定期的に全ネットワークへパケットが流れるため、無駄が発生しやすいです。

#### PIM-SM（Sparse Mode：希薄モード）★主流

* **想定:** 「受信者はポツポツとしかいない」という状況。
* **動き:** データが欲しいルーターが明示的に「参加（Join）」を表明したときだけ、配送ルートを作ります（プル型）。
* **核となる存在（RP）:** **ランデブーポイント (RP)** という中継地点を設定し、送信元と受信者をこの地点で引き合わせます。


### 3. PIMの仕組み：マルチキャスト配信ツリー

PIMは、パケットがループ（無限回廊）に陥らないように、また最も効率的に届くように、**「ツリー（木）」**のような構造をネットワーク上に作り上げます。

* **共有ツリー (Shared Tree):** どの送信者からのデータも一旦「RP（ランデブーポイント）」を経由して届けるルート。管理が楽ですが、ルートが遠回りになることがあります。
* **最短パスツリー (Source Tree / SPT):** 受信者から送信元へ直接向かう「最短ルート」。効率は最高ですが、送信元ごとにルートを作るためルーターの負荷が増えます。


### まとめ

* **PIM**は、既存のユニキャスト地図を利用して、マルチキャストの通り道を作るプロトコル。
* **課題解決:** どんな環境でも動き、受信者の数に合わせて無駄のない配送ルートを構築できるようになった。
* **現代の標準:** ほとんどの環境では、効率の良い **PIM-SM（Sparse Mode）** が利用されています。


