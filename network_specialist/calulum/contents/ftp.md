# FTP

FTP（File Transfer Protocol）は、その名の通りネットワーク上で **「ファイルを転送する」ための最も伝統的なプロトコル** です。

現在のWeb閲覧（HTTP/HTTPS）が「ページを表示する」ことに特化しているのに対し、FTPは「ファイルをサーバーへアップロードする」「サーバーからダウンロードする」という双方向のやり取りを専門としています。


### 1. FTPの最大の特徴：2つの「通り道」

FTPが他のプロトコルと決定的に違うのは、通信のために **2つのコネクション（通り道）** を同時に使う点です。

* **制御用コネクション（ポート21）:**
「ログインする」「ファイル一覧を見る」「削除する」といった **コマンド（命令）** をやり取りします。
* **データ転送用コネクション（ポート20など）:**
実際の**ファイルの中身（データ）**そのものを流します。

> **たとえ話:**
> 制御用コネクションは「電話での指示」で、データ転送用コネクションは「実際に荷物を運ぶトラック」のような関係です。


### 2. 「アクティブモード」と「パッシブモード」

FTPには、データ転送を始める際の「繋ぎ方」に2つのモードがあります。これが原因で「繋がらない」というトラブルがよく起こります。

* **アクティブモード:**
サーバー側からクライアントに接続しに行きます。しかし、クライアント側のファイアウォールにブロックされやすいため、現在はあまり使われません。
* **パッシブモード (PASV):**
クライアント側からサーバーに接続しに行きます。現代のインターネット環境（NATやファイアウォールがある環境）では、このモードが主流です。


### 3. FTPの弱点と現代の代替案

FTPは1970年代に作られた非常に古いプロトコルのため、現代の基準では致命的な弱点があります。

* **セキュリティの欠如:**
**ユーザーIDやパスワードが「平文（暗号化されていない状態）」** で流れます。同じネットワーク内に悪意のある人がいれば、簡単にかすめ取られてしまいます。

そのため、現在は以下の暗号化されたプロトコルが代わりに使用されています。

| 規格 | 特徴 |
| --- | --- |
| **FTPS** | FTPの通信をTLS/SSLで暗号化したもの。 |
| **SFTP** | SSH（セキュアシェル）の仕組みを利用してファイルを運ぶ。**（現在の主流）** |


### 4. 実際の利用シーン

* **Webサイトの更新:** 自分のPCで作ったHTMLや画像ファイルを、公開サーバーへアップロードする。
* **共有ストレージ:** 会社などのファイルサーバーに大量のデータを保存・取得する。


### まとめ

FTPは、**「命令用の道とデータ用の道を使い分け、確実にファイルを届ける仕組み」**です。

ただ、パスワードが丸見えというリスクがあるため、現在は「SFTP」や「FTPS」といった暗号化版を使うのがIT業界の鉄則となっています。


FTPが制御用コネクション（ポート21）とデータ転送用コネクション（ポート20など）を分離しているのには、当時のネットワーク環境や効率性を考慮した明確な理由があります。

一言でいうと、**「データの転送中に、転送そのものをコントロール（中断・状況確認）できるようにするため」**です。

---

### 1. 転送中の「割り込み」を可能にするため

もし1つのコネクションで「命令」と「データ」の両方を流していたら、巨大なファイルを転送している最中、そのコネクションはデータの塊で埋め尽くされてしまいます。

* **別々の場合:** ファイルをダウンロードしている最中に「やっぱり重いから中止（Abort）したい」と思ったとき、別の道（制御用コネクション）から「中止命令」を送ることで、サーバーに即座に反応させることができます。
* **同じ場合:** データの送信が終わるまで「中止」という命令自体がサーバーに届かず、制御が効かなくなってしまいます。

---

### 2. 通信の効率化と柔軟性

制御とデータを分けることで、それぞれに最適な通信のやり方を選択できるようになります。

* **制御用:** 小さなパケットで、確実かつ迅速に応答する必要があります（Telnetに近い仕組み）。
* **データ用:** データの種類（テキストモードか、画像などのバイナリモードか）によって、転送のルールを柔軟に切り替えることができます。

また、FTPには「サードパーティ転送」という古い機能があり、AサーバーからBサーバーへ直接ファイルを送る指示を、離れた場所にあるクライアントCが出すといった複雑な構成も、この分離構造によって可能になっていました。

---

### 3. ステータスの管理がしやすい

データ転送が終了すると、データ用コネクションは**「切断」**されます。

* データ用コネクションが閉じられたこと自体が「ファイルの終わり」を意味する合図になります。
* その間も制御用コネクションは維持されているため、転送が終わった直後に「次のファイルはどうする？」というやり取りをスムーズに続けることができます。

---

### 比較：HTTPとの違い

現代のHTTP（特にHTTP/1.1まで）は、1つのコネクションでリクエストとレスポンス（データ）を交互に送ります。

| 特徴 | FTP | HTTP (1.1まで) |
| --- | --- | --- |
| **コネクション数** | 2つ（制御＋データ） | 1つ（混在） |
| **転送中の制御** | 別の道から命令が可能 | 転送が終わるまで待つ必要がある |
| **接続の維持** | 制御用はずっと維持される | 基本的にやり取りのたびに使い捨てる |

---

### まとめ

FTPが2つの道を使い分けるのは、**「巨大な荷物を運んでいる最中でも、横から指示を出せるようにするため（アウトオブバンド制御）」**という設計思想に基づいています。

現在ではネットワークが高速化したため、HTTPのように1つの道でうまくやり取りする方式が主流になりましたが、当時はこの「2本立て」が最も理にかなった高度な仕組みだったのです。

**次は、この「2つの道を使う」という特徴が、なぜ現代のファイアウォール（セキュリティの壁）との相性が悪く、設定を難しくさせているのか、その理由についてお話ししましょうか？**
