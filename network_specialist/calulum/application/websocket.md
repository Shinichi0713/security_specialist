**WebSocket（ウェブソケット）**とは、ブラウザとサーバーの間で **「一度つなぎっぱなしにしたら、双方向で自由にデータをやり取りできる」** 通信プロトコルです。

これまでのHTTPが「リクエストに対してレスポンスを返す」という一往復のやり取りだったのに対し、WebSocketは **「電話の回線をつなぎっぱなしにする」** ようなイメージです。


### 1. HTTPとの決定的な違い

最大の差は、 **「どちらからでも、いつでも送れる」** という点にあります。

| 特徴 | HTTP | WebSocket |
| --- | --- | --- |
| **通信方向** | 片方向（リクエスト→レスポンス） | **双方向**（両方から自由に送信） |
| **接続の維持** | 一往復ごとに切断（原則） | **維持（つなぎっぱなし）** |
| **リアルタイム性** | 低い（更新を確認しに行く必要あり） | **極めて高い** |
| **オーバーヘッド** | 大きい（毎回長いヘッダーを送る） | **極めて小さい**（データ本体のみに近い） |


### 2. WebSocketが動く仕組み（ハンドシェイク）

WebSocketは、最初から独自の方式でつながるわけではありません。まずは **HTTPのふりをして挨拶** をすることから始まります。

1. **挨拶（ハンドシェイク）:** ブラウザがHTTPで「WebSocketに切り替えませんか？」というリクエスト（Upgradeヘッダー）を送ります。
2. **合意:** サーバーが「いいですよ（101 Switching Protocols）」と返します。
3. **変身:** この瞬間から、通信のルールがHTTPからWebSocketに切り替わり、専用の「トンネル」が開通します。
4. **自由通信:** 以降は、どちらかが切断するまで、最小限のデータ量で高速にやり取りを続けます。


### 3. どんなところで使われている？

「サーバー側で何かが起きた瞬間に、ブラウザへ伝えたい」という場面で無類の強さを発揮します。

* **チャットアプリ:** 相手がメッセージを打った瞬間に、自分の画面に表示される。
* **オンラインゲーム:** キャラクターの移動や攻撃など、ミリ秒単位の同期が必要な場面。
* **株価・仮想通貨チャート:** 1秒間に何度も変わる価格をリアルタイムで表示し続ける。
* **共同編集ツール:** Googleドキュメントのように、誰かが文字を打ったらすぐに他の人の画面にも反映される。


### 4. メリットとデメリット

#### メリット

* **リアルタイム:** サーバーからの「プッシュ通知」が即座に届く。
* **通信量の節約:** 接続を維持するため、毎回「宛先」や「自己紹介（ヘッダー）」を送る必要がなく、データが軽い。

#### デメリット

* **サーバーの負荷:** 接続を維持し続けるため、同時に何万人もつなぐとサーバーのメモリを消費しやすい。
* **不意の切断:** ネット環境が不安定だと接続が切れやすいため、自動で再接続する仕組みが必要。


### まとめ

* **WebSocket**は、Webで**「リアルタイム・双方向」**を実現するための専用道路。
* 最初は**HTTPで挨拶**し、その後は**つなぎっぱなし**で高速通信。
* **チャットやゲーム**など、スピードが命のサービスには欠かせない技術。

## WebRTC

**WebRTC (Web Real-Time Communication)** とは、ブラウザ同士がサーバーを介さずに、**直接（P2P：ピア・ツー・ピア）通信**を行って、音声・ビデオ・データをリアルタイムにやり取りするための技術です。

ビデオ会議（Google MeetやZoomのブラウザ版など）の裏側で動いている主役の技術です。

---

### 1. WebRTCの最大の特徴：P2P（直接通信）

これまでの通信（HTTPやWebSocket）は、必ず「サーバー」が間に入ってデータを転送していましたが、WebRTCは**「ブラウザとブラウザが直接つながる」**のが最大の違いです。

* **低遅延:** サーバーを経由する時間がカットされるため、コンマ数秒を争うリアルタイム通信が可能です。
* **UDPの採用:** TCPではなく、スピード重視の**UDP**（欠損を許容して速く送る）をベースにしています。
* **標準搭載:** 追加のプラグインやアプリなしで、ブラウザ（Chrome, Safari, Edgeなど）だけで動作します。

---

### 2. WebSocketとの違い

「つなぎっぱなしの双方向通信」という点ではWebSocketと似ていますが、その目的や構造は大きく異なります。

| 比較項目 | WebSocket | WebRTC |
| --- | --- | --- |
| **接続相手** | クライアント ↔ **サーバー** | クライアント ↔ **クライアント** (P2P) |
| **主な用途** | テキストチャット、株価、ゲームの操作 | **ビデオ通話、音声通話**、大容量ファイル共有 |
| **プロトコル** | TCP（確実性重視） | **UDP**（速度重視） |
| **得意なデータ** | 小さなメッセージ、JSONデータ | **巨大なストリームデータ（映像・音声）** |
| **通信の確立** | シンプル（HTTPで開始） | 複雑（シグナリングという準備が必要） |

---

### 3. WebRTCはどうやって「直接」つながるのか？

実は、ブラウザ同士がいきなり直接つながるのは非常に困難です（お互いのネット上の住所がわからなかったり、セキュリティの壁があるため）。そこで、以下の3つの役割のサーバーが「準備」を助けます。

1. **シグナリングサーバー:** 「これから通信したいんだけどいい？」という挨拶（SDPという情報の交換）を仲介します。※ここに**WebSocket**が使われることが多いです。
2. **STUNサーバー:** 自分のネット上の「外向きの住所（IPアドレス）」を教えてくれる鏡のような存在です。
3. **TURNサーバー:** どうしても直接つながらない場合、最終手段としてデータを「中継」してくれます。

---

### 4. どっちを使うべき？

* **「サーバーと常に会話したい、小さなデータを送りたい」**なら **WebSocket**。
（例：チャットメッセージ、通知、共同編集のテキスト）
* **「ユーザー同士で、映像や音声を最高速度で送りたい」**なら **WebRTC**。
（例：ビデオ通話、画面共有、1対1のファイル転送）

### まとめ

* **WebRTC**は「ブラウザ同士が直接話す」ための超高速・大容量プロトコル。
* **WebSocket**は「サーバーと常におしゃべりする」ための安定したプロトコル。

実際には、**WebSocketで「今から話せる？」と聞き、OKならWebRTCに切り替えてビデオ通話を始める**といった具合に、両方を組み合わせて使うのが現代のWebサービスの王道です。



