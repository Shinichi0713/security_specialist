
ネットワークには、PC以外にもさまざまなものが接続されています。
それも、いつだれが接続したかもわからないようなものがつながっていて、びっくりすることもあります。

そんな接続物を把握するために使うためのルールが **SNMP（Simple Network Management Protocol）** と言われるプロトコルです。

## 概要
**SNMP（Simple Network Management Protocol）** とは、一言でいうと **「ネットワーク上の機器（ルーター、スイッチ、サーバーなど）を、遠隔から一括で監視・制御するための共通ルール」** です。
広大なオフィスやデータセンターにある何百台もの機器を、1台ずつ手作業で確認するのは不可能です。
そこで、SNMPという「共通言語」を使って、管理用のPCからすべての機器の状態を自動で集約するために存在しています。


### 1. SNMPの役割：何ができるのか？

SNMPを使うと、管理者は自分の席にいながら以下のような情報を把握できます。

* **死活監視:** 「あのルーター、今動いてる？」
* **リソース監視:** 「サーバーのCPU使用率やメモリ残量は大丈夫？」
* **トラフィック監視:** 「ネットワーク回線が混み合っていないか？」
* **状態変化の通知:** 「通信ポートが故障した」「温度が異常に上がった」といったトラブルの即時受信。

### 2. SNMPを支える「3つの登場人物」

SNMPは、以下の3つの要素が連携して動きます。
ネットワークがどれほど巨大になっても、基本はこの3者のやり取りで完結します。

#### ① SNMPマネージャー（管理者）

管理用のサーバーやPCで動くソフトウェアです。各機器に「調子はどう？」と問いかけたり、異常の報告を受け取ったりする **「司令塔」** です。

#### ② SNMPエージェント（監視対象）

ルーターやサーバーなどの機器内で動くプログラムです。マネージャーからの質問に答えたり、異常時に自分から報告したりする **「現場の担当者」** です。

#### ③ MIB（ミブ：情報のデータベース）

エージェントが持っている「情報の棚」のようなものです。

* **仕組み:** 機器の情報（CPU温度、パケット数など）には、 **OID（オブジェクトID）** という住所のような番号（例：1.3.6.1...）が割り振られており、MIBという辞書を見ることで「この番号はCPU温度のことだ」と翻訳できます。

__SNMPの構成図__

| 役割 | 物理的な実体 | 主な動き |
| --- | --- | --- |
| **マネージャー** | 管理用サーバー | データの要求(Get)、トラップの受信 |
| **エージェント** | 各ネットワーク機器 | データの回答(Response)、異常通知(Trap) |
| **通信路** | IPネットワーク | UDP 161番(リクエスト) / 162番(トラップ) |

### 通信の仕組み

#### ネットワークの管理構成（トポロジー）

この構成を理解するために重要な「3つのコンポーネント」と「管理の仕組み」を解説します。
物理的な構成としては、 **「1対多」** の形をとります。

1. **中央管理センター:** マネージャーが稼働するサーバーを1カ所に設置します。
2. **監視対象の広がり:** そこからIPネットワークを通じて、社内LAN、VPN越しの支店、データセンターにある全ての機器と通信します。
3. **セグメントを越えた管理:** ルーターをいくつも越えた先にある機器でも、IPで到達できればSNMPで管理可能です。

#### 通信の2つのパターン

SNMPには、情報のやり取りに2つのスタイルがあります。

#### A. ポーリング（定期的にお伺いを立てる）

マネージャーが各エージェントに対して、数分おきに「調子はどうですか？」と順番に聞いて回ります。

* **メリット:** 機器が生きているか（死活監視）を確実に把握できる。
* **デメリット:** 機器の数が増えると、マネージャーの処理負荷とネットワークの帯域消費が増える。

#### B. トラップ（異常時に現場から叫ぶ）

機器側で「電源が落ちそう」「異常な温度を検知した」などのイベントが発生した際、マネージャーからの問いかけを待たずに自発的に通知を送ります。

* **メリット:** トラブルをリアルタイムに検知できる。
* **デメリット:** ネットワークが完全に遮断されていると、この叫びがマネージャーに届かない。


### 3. 実際の運用イメージ：マルチベンダー管理

SNMPの最大の強みは、 **「メーカーが違っても同じ構成で管理できる」** 点です。

* Ciscoのルーター
* ヤマハのスイッチ
* Windowsのサーバー
* リコーのプリンター

これらが混在していても、各メーカーが「SNMPエージェント」を機器に搭載しているため、管理者は1つのマネージャーソフト（例：Zabbix, Hinemos, SolarWindsなど）を見るだけで、全ての機器を一元管理できます。

### 4. 歴史とセキュリティの進化

SNMPには主に3つのバージョンがあり、時代とともにセキュリティが強化されてきました。

* **SNMPv1 / v2c:** 設定が簡単で広く普及していますが、パスワード（コミュニティ名）が暗号化されず平文で流れるため、セキュリティ上のリスクがあります。
* **SNMPv3:** データの暗号化とユーザー認証に対応した最新版です。現在のビジネスネットワークでは、この**v3**の使用が強く推奨されています。

## コミュニティ
SNMPにおける **「コミュニティ（Community）」** という言葉は、一般的な「地域社会」や「仲間内」という意味に近く、ネットワークの世界では **「同じ管理ルールを共有するグループ（範囲）」** という概念を指します。

### 1. 「同じ鍵を持つグループ」という概念

SNMPのコミュニティは、 **「マネージャー（管理者）」と「エージェント（機器）」が、お互いを「同じグループの仲間だ」と認識するための枠組み** です。

* **境界線:** ネットワーク内には膨大な機器がありますが、コミュニティ名を設定することで、「管理対象のグループ」と「それ以外」の境界線を引きます。
* **合言葉:** そのグループに参加するための合言葉が「コミュニティ名」です。マネージャーが「名前：sales-group」という合言葉を添えてリクエストを送ると、同じ「sales-group」に所属する機器だけが反応します。

### 2. 権限による「階層化」

コミュニティの概念には、 **「できることの範囲（権限）」** も含まれます。通常、1つの機器に対して複数のコミュニティ（グループ）を定義できます。

* **閲覧グループ（Read-Only）:** 「データを見ることだけ」が許されたコミュニティ。監視ソフトなどがここに参加します。
* **操作グループ（Read-Write）:** 「設定を変えること」まで許された強力なコミュニティ。管理者のメンテナンス端末だけがここに参加します。

このように、コミュニティという概念によって「誰が、どこまでできるか」という**アクセス制御**を実現しています。


### 3. なぜ「認証」ではなく「コミュニティ」と呼ぶのか？

現代のパスワード認証と違い、SNMP（v1/v2c）のコミュニティには「ユーザー（個人）」という概念がありません。

* **個人の識別がない:** 「Aさんがログインした」ではなく、「『public』という合言葉を知っている人が来た」としか判断できません。
* **性善説の名残り:** もともとSNMPが設計された頃は、「同じネットワーク内に悪い人はいない」という性善説に基づいていたため、複雑なID/パスワード形式ではなく、ゆるやかな「グループ名（コミュニティ名）」という概念が採用されました。

### 4. コミュニティ概念の使われ方のイメージ

例えば、社内に「営業部」と「技術部」のネットワークがある場合、以下のようにコミュニティを分けることができます。

* **営業部用コミュニティ（名前: eigyo-mon）:** 営業部のルーターのみが反応する。
* **技術部用コミュニティ（名前: gijutsu-mon）:** 技術部のスイッチのみが反応する。

管理者は、マネージャーソフトにそれぞれのコミュニティ名を登録することで、 **「どの名前を使って、どの範囲の機器を管理するか」** を整理しています。

## まとめ
社内などのネットワークを管理するために利用されるSNMPについて説明しました。
因みにですが。

SNMPは非常に古く、かつ枯渇した技術だと思われがちですが、その裏側には意外な事実や、現代のエンジニアでも驚くような仕組みが隠されています。

__1. 意外と「なんでも屋」：IT機器以外も監視している__

SNMPはルーターやサーバーのためだけのものと思われがちですが、実は「IPアドレスが振れるもの」なら、ITとは無縁そうな機器も監視しています。

- 家庭・ビルの設備: 巨大なデータセンターの **エアコン、UPS（無停電電源装置）、さらにはスマートPDU（電源タップ）** なども、SNMPで「今、何度か」「どれくらい電気を使っているか」を報告しています。
- 放送機器: テレビ局の送信機やカメラのコントローラーなども、SNMPを使って一括管理されていることがあります。

__2. 「Simple」という名前なのに、実は全然シンプルじゃない__

SNMPの「S」は Simple の略ですが、エンジニアの間では「ちっともシンプルじゃない」と有名です。

- 理由: 監視項目の住所にあたる OID（オブジェクトID） が、1.3.6.1.4.1.9... といった非常に長く、人間には理解不能な数字の羅列で構成されているからです。
- 事実: この複雑なツリー構造を解析・管理するために、世界中のエンジニアが今も「MIBファイル」という膨大な辞書と格闘しています。

ということで不思議なプロトコルなのでした。


