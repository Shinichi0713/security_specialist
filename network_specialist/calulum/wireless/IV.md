
Initialization Vector（初期化ベクトル）、通称 **IV** とは、暗号化を行う際に**「同じ平文（元のデータ）を、毎回異なる暗号文に変えるため」**に加えられる、一回限りのランダムなデータのことです。

---

### 1. なぜ IV が必要なのか？

暗号化アルゴリズムにおいて、同じ鍵を使って同じメッセージを暗号化すると、常に同じ暗号文が生成されます。これはセキュリティ上、非常に危険です。

**例：ある日のチャット通信**

* 1回目：「おはよう」 → 暗号文：`XyZ123`
* 2回目：「おはよう」 → 暗号文：`XyZ123`

これでは、たとえ中身が解読できなくても、盗聴者は「あ、また `XyZ123` が流れたから、これは『おはよう』だ」と推測できてしまいます（これを**パターン分析**と呼びます）。

IV を使うと、結果はこうなります：

* 1回目：「おはよう」 ＋ **IV(A)** → 暗号文：`AbC987`
* 2回目：「おはよう」 ＋ **IV(B)** → 暗号文：`QwE456`

このように、**「同じ内容でも見た目を変える」**のが IV の役割です。

---

### 2. IV の仕組み（RC4やAESなどの場合）

暗号化のプロセスに IV がどう組み込まれるかを、先ほどの「手紙」の例で見てみましょう。

1. **ランダムな IV を生成する:** 送信側が毎回、デタラメな数字（IV）を作ります。
2. **鍵と組み合わせる:** 本来の「秘密鍵」に「IV」を合体させて、その回限りの「一時的な鍵」を作ります。
3. **暗号化する:** その一時的な鍵でデータを暗号化します。
4. **IV も一緒に送る:** 受信側も同じ IV がないと復号できないため、暗号文と一緒に **IV は平文（暗号化せず）のまま** 送ります。「今回の IV はこれを使ってね」というメモを添えるようなイメージです。

---

### 3. WEP における IV の失敗

以前の質問に出てきた **WEP** が破られた最大の原因も、この IV にあります。

* **短すぎた:** WEP の IV はわずか **24ビット** でした。これは約 1,600 万通りしかありません。
* **重複の発生:** 通信量が多いネットワークでは、数時間もあれば同じ IV が使い果たされ、使い回し（重複）が発生してしまいます。
* **解読の鍵:** RC4 のようなストリーム暗号で IV が重複すると、数学的な計算（XORの性質）によって、鍵そのものが恐ろしい速さで割り出されてしまいます。

これが、WEP が「数分で解読できる」と言われる理由です。

---

### 4. IV のルール

IV を安全に使うためには、以下のルールが鉄則です。

* **再利用しない（唯一性）:** 同じ鍵で同じ IV を二度と使わないこと。
* **予測不可能（ランダム性）:** 次の IV が何かを攻撃者に予想させないこと。

現代の **WPA2 (AES)** などでは、IV に相当する値が非常に長く設計されており、重複や予測が実質的に不可能なようになっています。

---

### まとめ

IV（初期化ベクトル）は、**「暗号に『新鮮さ』を与え、パターンを見破られないようにするためのスパイス」**のようなものです。

先ほど実装した Rust の RC4 コードには IV の仕組みが入っていませんでしたが、実用的な暗号化を行う際は、`Rc4::new` の引数に「鍵 ＋ IV」を渡すように設計するのが一般的です。

**次は、この IV が現代の標準「AES」でどのように進化して使われているのか、具体的なブロック暗号のモード（CBCモードなど）について解説しましょうか？**