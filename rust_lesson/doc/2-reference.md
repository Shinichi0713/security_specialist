Rustの勉強していて、練習程度ならば、一つのファイルで文法チェックしてればよかったのですが、少し機能を持たせる成果物を作りたいとなってきて、ファイルを分割したくなってきました。
なので、他ファイルの参照の仕組みをようやく使うときが来ました。

Rustで別のファイルにある関数を読み込むには、 **「モジュール（module）」** という仕組みを使います。

他の言語（Pythonの`import`やC++の`#include`）と少し感覚が異なり、 **「ファイル構造＝モジュール構造」** としてRustに教えてあげる必要があります。


## 基本的な手順（Cargoプロジェクトの場合）

例えば、`main.rs` から `utils.rs` にある関数を呼び出す手順を説明します。

ファイルはこんな感じで配置するとします。

```text
my_project/
├── Cargo.toml
└── src/
    ├── main.rs   <-- (親) ここで mod utils; を宣言
    └── utils.rs  <-- (子) 実際の処理を書く。関数には pub をつける

```

### 1. 呼び出される側のファイル (`src/utils.rs`)

関数を他のファイルから見えるようにするために、**`pub`** キーワードを付けます。

```rust
// src/utils.rs

// pub を付けることで外部（他のファイル）からアクセス可能になる
pub fn hello_from_utils() {
    println!("utils.rsの関数が呼ばれました！");
}

```

### 呼び出す側のファイル (`src/main.rs`)

`main.rs` で「`utils.rs` というファイルが存在し、それをモジュールとして使う」ことを宣言します。

```rust
// src/main.rs

// 1. utils.rs をモジュールとして登録（ファイル名がモジュール名になる）
mod utils;

fn main() {
    // 2. 「モジュール名::関数名」で呼び出す
    utils::hello_from_utils();
}

```


## フォルダ構成のイメージ

Cargoプロジェクトでは、ファイルは必ず `src` フォルダの中に置く必要があります。


## 知っておくと便利な応用

### `use` を使って短縮する

毎回 `utils::` と書くのが面倒な場合は、`use` を使うと直接関数名だけで呼べるようになります。

```rust
mod utils;
use utils::hello_from_utils; // これを足すと...

fn main() {
    hello_from_utils(); // 直接呼べる！
}

```

### フォルダで管理する場合

ファイルが増えて、`src/tools/network.rs` のようにフォルダ分けしたい場合は、少し特殊なルール（`mod.rs` を置くか、フォルダ名と同じ名前の `.rs` ファイルを作る）が必要になります。

1. `src/tools.rs` を作成し、その中で `pub mod network;` と宣言する。
2. `src/tools/network.rs` に関数を書く。
3. `main.rs` で `mod tools;` と宣言する。


### トラブルシューティング：`mod` を書く場所

よくある間違いは、 **`utils.rs` の中にも `mod utils;` と書いてしまうこと** です。

* **`mod` 宣言**は、そのファイルを「子」として持つ「親」のファイル（今回なら `main.rs`）に一度だけ書きます。


